<center>
<img src="../images/introduction/ustacklog.png" width="60%" height="60%" />
</center> 



<center>
<B><font size=7>UCloudStack 管理员手册 </font></B>
</center>












<center>
<B><font size=5>产品版本：V1.22.0 </font></B>
</center>



<center>
<B><font size=4>文档版本：202104 </font></B>
</center>































[toc]


























# 版权声明

版权所有 ©  优刻得科技股份有限公司 2021 保留一切权利。

非经本公司书面许可，任何单位和个人不得擅自摘抄、复制本文档内容的部分或全部，并不得以任何形式传播。

UCloudStack 商标和 UCloud 商标为优刻得科技股份有限公司所有。对于本手册中可能出现的其它公司的商标及产品标识，由各自权利人拥有。

注意您购买的产品、服务或特性等应受优刻得科技股份有限公司商业合同和条款约束，本文档中描述的全部或部分产品、服务或特性可能不在您的购买或使用权利范围之内。除非合同另有约定，优刻得科技股份有限公司对本文档内容不做任何明示或暗示的声明或保证。

由于产品版本升级或其它原因，本文档内容会不定期更新，除非另有约定，本文档仅作为使用指导，本文档中的所有陈述、信息和建议不构成任何明示或暗示的担保。

本文档描述 UCloudStack （v1.22.0）云平台的管理员运维运营功能说明和操作指南，适用于需要通过管理控制台管理并运营整个平台的资源、账户、计费及相关配置的平台管理者和运营者，平台租户及开发者可参考用户指南和 API 开发者文档。





































# 1 概述

## 1.1 平台简介

云平台统一管理服务为企业用户提供租户视角和管理视角两套控制台，租户控制台用于平台租户虚拟资源管理，管理控制台用于平台管理者对云平台整体的运营运维。

租户控制台为租户（主/子帐号）提供的 Web 云资源管理平台，支持租户主/子账号管理及权限控制，可对云平台所有产品服务的虚拟资源进行全生命周期管理，同时可对虚拟资源进行监控告警、计量计费及日志审计等管理。

管理控制台为平台管理者及运维人员提供的 Web 运营运维管理平台，使用管理员账号统一管理整个云平台全局，拥有平台所有管理权限，包括全平台账号认证、多租户管理、资源管理、流程审批、计量计费、监控告警、审计日志、平台管理及运维迁移等管理功能模块，同时提供大屏监控服务，支持自由布局灵活投屏，提升平台资源的数据可视化效果。

## 1.2 基础概念

云平台作为软件平台部署至物理服务器节点，最终以云服务的形式对外提供虚拟化产品。管理控制台支持管理数据中心级别的计算、存储及网络资源，并可将数据中心从逻辑上划分为多个集群，通过统一账号认证体系管理平台提供的云资源。针对平台在使用和运营过程中会涉及的基础概念如下：

* **地域**

  地域（Region）是云平台中的一个逻辑概念，指资源部署的物理位置分类，可对应机柜、机房或数据中心。

  通常一个数据中心对应一套 UCloudStack 云平台，数据中心之间资源和网络完全物理隔离，可通过一套管理平台管理遍布各地数据中心的私有云平台。

* **集群**

  集群（Set）是平台物理资源的逻辑划分，用于区分不同配置规格及不同存储类型的服务节点，如 X86 计算集群、ARM 计算集群、SSD 存储集群或商业存储集群等。

  一个数据中心可支持部署多个计算和存储集群，一个集群通常由一组配置、用途相同的物理节点组成，用户可将虚拟资源部署于不同的计算集群，并可跨集群挂载分布式块存储设备。

* **管理员账号**

  管理员 `admin` 账号是管理员控制台账号，拥有平台所有管理权限，用于全局管理和运营整个云平台。可通过管理员账号管理云平台的地域、集群、租户、资源、计费、审批、安全及平台全局配置；同时也可对管理员账号自身进行安全管理。

* **租户**：

  平台支持多租户模式，用于有多级组架构构的企业，可将租户作为一个单独的公司进行运营，有效实现权限管理，除低总公司、子公司及不同部门资源混用可能造成的风险，并可实现资源审计。

  租户是平台中一组资源的集合，提供资源隔离、子账号、权限控制、配额及价格配置等能力。不同租户间资源通过 VPC 网络及权限实现强隔离；租户内所有主账号和子账号的资源、费用、配额及审批均归属于租户。

- **主账号**

  一个租户必须有一个主账号，主账号默认有租户下所有资源及管理的全部权限。可通过主账号创建和管理子账号，并管理子账号的权限。

- **子账号**

  子账号是主账号创建的用户，子账号在租户下的权限由主账号控制。一个租户可拥有多个子账号，支持对子账号进行资源管理的权限控制。

- **外置存储**

  平台默认提供分布式存储，外置存储是指平台通过 ISCSI 协议对接的商业存储资源池（如 IPSAN），支持一键扫描商业存储中的 LUN 存储卷信息，并可将存储卷作为虚拟机的系统盘和数据盘。

* **外网网段**

  外网网段是平台对外通信的网络，一般由管理员或运维人员通过物理网络分配并配置至云平台。外网网段是平台为租户分配外网 IP （弹性 EIP）的 IP 资源池，支持 IPv4 和 IPv6 两种 IP 类型，并支持配置网段路由并自动下发路由至平台虚拟机。

# 2 组织和账号管理

组织和账号管理主要为企业用户提供组织架构管理，支持多租户模式，每个租户代表一个组织。可以基于租户进行资源访问控制、资源创建的流程管理。平台组织和账号管理分为租户侧和管理员侧两个维度。本章主要介绍管理员账号，租户侧的账号与组织管理请参考用户手册组织和账号管理部分内容。

## 2.1 管理员账号

管理员 `admin` 账号是管理员控制台账号，拥有平台所有管理权限，用于全局管理和运营整个云平台。可通过管理员账号管理云平台的地域、集群、租户、资源、计费、审批、安全及平台全局配置。

作为平台管理员账号，拥有平台最高权限，针对管理员账号自身的安全平台提供修改登录密码、找回密码、双因子验证登录、登录访问限制、修改登录邮箱等安全防护功能；同时支持获取 Admin 管理员的 API 密钥信息，用于通过 API 接口查询平台全局资源及运行信息。

> 平台账号体系目前均使用邮箱地址作为平台的登录账号，在使用前需确保提供的账号邮箱地址可用，方便接收告警邮件或找回密码等。

平台默认使用 `admin@ucloud.cn` 邮箱地址作为平台的管理员账号，使用 admin 账号登录控制台即会自动登入管理员控制台，使用其它账号登录控制台会自动登录入租户控制台。管理员在账号与组织管理/我的账号页面可查看账户基本信息并对账号进行安全设置。

### 2.1.1 修改登录密码

在使用 admin 账号时，若需要更改管理员密码，可通过管理员控制台右上角管理员账号头像中的【修改登录密码】进行修改。修改密码时需要提供当前登录密码，确认当前登录密码无误后，即可完成账号的密码修改。

如果忘记当前登录密码，可通过【找回密码】功能重设 admin 账号的密码，避免无法登录控制台。

### 2.1.2 找回密码

平台支持管理员账号在忘记密码时通过控制台自主找回密码，找回密码时需通过邮箱进行验证，需确保管理员添加的账号为真实可用的邮箱。通过登录⻚面的【找回密码】功能，即可使用邮箱地址验证􏰀为账号设置新密码。

􏰀置密码成功后，即可使用最新设置的密码登录云平台，进行云平台资源的运营和管理。

### 2.1.3 双因子验证登录

平台为 admin 账号提供免费的基于 TOTP（Time-Based One-Time Password Algorithm）登录二次认证服务，开通本服务后，管理员每次登录控制台均需通过授权认证。 为降低账号密码泄漏造成的风险，建议您开通账号登录，开通步骤始下：

1. 登录控制台并进入账号控制台，通过管理员头像中的【开启登录保护】进行操作，如下图所示：

   ![loginprotect](../images/adminguide/loginprotect.png)

2. 检查移动设备上是否安装 FortiToken ：

- 页面提供 IOS 和 Android 用户工具下载地址，若您未安装 FortiToken 可通过扫码下载。
- 安卓手机用户也可以通过手机品牌商提供的应用商店搜索和下载 FortiToken 。

3. 打开 FortiToken 工具，扫码获取授权码，也可手动输入密钥获取授权码。

4. 在页面方框内输入获取到的授权码，完成绑定。

开启双因子验证后，管理员账号每次登录控制台均需通过二次认证。登录时在输入账号密码后，需要额外再输入授权码后才可成功登录账号，如下图所示：

![fortitoken](../images/adminguide/fortitokenlogin.png)

可登录控制台点击管理员账号头像中的【关闭登录保证】，输入 6 位授权码，即可关闭双因子验证功能。

### 2.1.4 登录访问限制

为保证账号登录的安全及对特定安全场景的需求，平台提供账号登录访问限制能力，为管理员账号设置登录控制台和访问 API 的客户端 IP 地址，配置后管理员账号只能从指定的 IP 登录或发起 API 访问，保证管理员登录及资源管理的安全性。

* 支持配置多个 IP 地址或 IP 地址段，多个 IP 地址/段间使用英文逗号进行分隔。
* 配置的 IP 地址 或 IP 地址段为白名单模式，即配置的 IP 地址/段客户端才可正常登录控制台或访问 API 。
* 默认不指定任何 IP ，代表不限制登录控制台和访问 API 的客户端 IP 地址，即默认全网可访问登录控制台。

> 为保证管理员账号可正常登录控制台，设置时需保证至少有一段可通达的地址配置在登录访问范围内，否则可能导致无法登录管理。

管理员可通过头像操作中的【登录访问限制】功能进行登录策略配置，如下图所示，默认为空代表全网无限制。

![LoginWhitelist](../images/adminguide/LoginWhitelist.png)

可在登录访问范围内输入可登录平台的 IP 地址或 IP 地址段，点击确认即可生效。配置成功后，管理员账号在未指定的 IP 网络中无法正常登录控制台，并提示当前的 IP 地址，如下图所示：

![LoginWhitelist1](../images/adminguide/LoginWhitelist1.png)

平台仅可限制访问控制台的 IP 地址，即直接请求到控制台 URL 地址的客户端 IP 地址，如用户使用管理员账号访问平台的客户端地址在 NAT 路由内，则平台配置登录策略时，需要放通 NAT 后的 IP 地址，即需要将 NAT 后的出口地址配置在登录访问策略的白名单中，保证 NAT 路由器内的客户端均可正常访问控制台。

### 2.1.5 修改登录邮箱

平台支持管理员修改管理员的账号邮箱地址，用于将管理员账号修改为真实可用且实际需要接收告警邮件的邮箱地址，具体修改操作如下图所示：

![updateadminemail](../images/adminguide/updateadminemail.png)

管理员修登录邮箱修改后可使用原有密码登录控制台，可通过修改登录密码重置管理员邮箱密码。

### 2.1.6 获取 API 密钥

支持开发者通过 admin 账号获取管理员账号的 API 密钥 ，用于使用平台管理的 API 接口 获取平台全局资源的信息，如下图所示：

![adminapisec](../images/adminguide/adminapisec.png)

可通过点击复制按钮进行公私密钥的信息复制，以方便 API 指令的调用。

## 2.2 租户 

平台支持多租户模式，用于有多级组架构构的企业，可将租户作为一个单独的公司进行运营，有效实现权限管理，除低总公司、子公司及不同部门资源混用造成的风险，并可实现对资源的审计。

租户是平台中一组资源的集合，提供资源隔离、子账号及权限控制、配额及价格配置等能力。不同租户间资源通过 VPC 网络及权限实现强隔离；所有主账号和子账号的资源、使用的费用、资源的配额及流程审批均以租户为单位。

租户可由平台管理员创建，创建租户时默认会生成一个用户账号，此账号即为租户的主账号，也是租户下的管理人员。注册成功后需要管理员进行充值才可进行使用。平台管理员可对平台的所有租户进行生命周期管理，包括创建租户、激活账号、修改名称、冻结、解冻、登录访问限制、开关审批流程。并可对租户进行配额管理 、价格配置、账号充值及主子账管理、查看租户的资源概览、订单信息、交易信息及充值信息，详见 [租户管理](#_7-租户管理) 。

# 3 地域管理

地域（Region）是云平台中的一个逻辑概念，指资源部署的物理位置分类，可对应机柜、机房或数据中心。通常一个数据中心对应一套 UCloudStack 云平台，可支持部署多个计算和存储集群；数据中心之间资源和网络完全物理隔离，可通过一套管理平台管理遍布各地数据中心的私有云平台。

地域在平台也称为数据中心，通常数据中心之间完全隔离以保证最大程度的稳定性和容错性。作为平台最大的资源定义，一个地域即部署一套 UCloudStack 云平台。平台默认内置一个地域，管理服务通过本地数据中心云平台提供的 API 端点管理地域内计算、存储及网络资源。支持对数据中心内资源的生周期管理，包括计算集群、存储集群、外置存储、基础镜像及自制镜像等资源的查看和维护。

## 3.1 查看地域

### 3.1.1 地域列表

通过管理员控制台左侧导致栏的【地域】即可进入地域列表页，可查看当前下已有的地域列表，包括地域 ID、地域名称、Endpoint、总核数、已分配核数、总内存、已分配内存及创建时间，同时也可通过“自定义列表”按钮，自定义列表所需信息，如下图所示：

![regionmanage](../images/adminguide/regionmanage.png)

- 地域 ID：地域在平台的唯一标识符，如 `cn` ，通常也作为 API 接口的请求参数值。
- 地域名称：地域的名称，可通过独立的命名区分不同地域，比如北京数据中心一号机房。
- Endpoint：每个地域的 API 服务端点，平台管理控制台通过 API 端口访问并管理数据中心资源。
- 总核数：地域下总的 vCPU 核数，即平台用户在地域中可使用的总 vCPU 核数，默认情况不进行超分。
- 已分配核数：地域下已分配 vCPU 核数，即平台用户在地域中已申请的 vCPU 核数。
- 总内存：地域下总内存容量，即平台用户在地域中可使用的总内存容量，不支持超分。
- 已分配内存：地域下已分配到总内存容量，即平台在地域中用户已申请的内存容量。
- 创建时间：地域的创建时间

> 如一个地域已分配的 vCPU 和内存比例超过 80% 以上，代表地域下可用 vCPU 和内存资源较少，通常需要进行扩容；也可统计租户云资源使用率并及时释放云资源，确保真正需要使用资源的用户可分配到云资源。

### 3.1.2 地域详细信息

用户可在地域列表中点击地域名称，或者点击目标地域列表右侧的“详情”按钮进入当前地域的概览页面，查看地域的基本信息及监控信息，同时可以切换到基础镜像、自制镜像、计算集群、存储集群及外置存储标签页，查看和管理地域下的基础镜像、自制镜像及计算存储资源，如下图所示：

![regiondetails](../images/adminguide/regiondetails.png)

概览页面展示基本信息和地域核心资源使用趋势的监控图表。

* 基本信息：主要展示基本信息包括地域ID、地域名称、创建时间、EndPoint、总核数、已分配核数、总内存、已分配内存。
* 监控信息：可查看地域的监控信息，其中监控指标包括计算实例数（总数/运行/停止）、CPU 核数（总核数/已用/可用）、内存容量（总容量/已用/可用）。可通过筛选按钮，调节图表的显示时间周期，满足根据不同时间颗粒度的查看地域核心资源使用趋势的需求。

平台中的物理资源和虚拟资源均有地域属性，即必须部署或运行于一个数据中心，详情中的基础镜像、自制镜像、计算集群、存储集群及外置存储管理均指当前地域的资源信息：

* 基础镜像管理：指地域中的虚拟机基础镜像，即平台初始化是提供给用户创建虚拟机使用的镜像文件，同时支持本地域的基础镜像的管理，如删除基础镜像，可参考全局镜像管理中基础镜像章节。
* 自制镜像管理：指平台所有租户在地域中的自制镜像，并支持本地域的自制镜像管理，如导入镜像、删除镜像等，可参考全局镜像管理中的自制镜像章节。
* 计算集群：指平台在地域中部署的计算集群，计算集群是一组作为计算节点使用的物理机逻辑集合。可查看地域下的计算集群列表以及集群的资源总量和分配情况，并支持本地域的计算集群管理，可参考全局集群管理中的计算集群章节。
* 存储集群：指平台在地域中部署的存储集群，可查看地域下的存储计算列表以及集群的资源总量和分配情况，并支持本地域的存储集群管理，如修改集群的租户权限，可参考全局集群管理中的存储集群章节。
* 外置存储：指平台在地域中对接的外置存储池，即通过 ISCSI 协议对接的商业存储资源池，将商业存储作为虚拟化后端存储。支持查看并管理商业存储池，如扫描并分配存储池的 LUN 存储卷信息，可参考全局集群管理中的外置存储章节。

## 3.2 修改地域

支持管理员修改地域的名称，即显示在租户控制台的地域筛选中的名称。在管理平台地域管理列表，点击对应地域右侧的【修改】按钮进行操作，如下图所示：

![editregion](../images/adminguide/editregion.png)

修改地域名称即时生效，重新登录租户端控制台，即可查看已修改的地域名称。

# 4 集群管理

集群（Set）是平台物理资源的逻辑划分，用于区分不同配置规格及不同存储类型的服务节点，如 X86 计算集群、ARM 计算集群、SSD 存储集群或商业存储集群等。一个数据中心可支持部署多个计算和存储集群，一个集群通常由一组配置、用途相同的物理节点组成，且服务节点一般具有相同的 CPU/内存、磁盘类型及操作系统。

![region-set](../images/adminguide/region-set.png)

云平台支持将 X86、ARM、GPU 等异构计算集群统一管理，并可统一管理 SSD、STAT、NVME 多种架构存储集群。 用户可将虚拟资源部署于不同的计算集群，并分别对虚拟资源挂载不同存储集群的块存储设备。

服务器为计算&存储融合节点时，不同磁盘类型的节点划分为一个集群，如 SSD 计算节点集群；若服务器为独立存储节点时，不同磁盘类型的节点划分为一个集群，如 SATA 存储节点集群。通常一个集群的服务器建议接入同一组接入交换机，业务数据网络仅在集群内进行传输。

平台支持管理员账号对数据中心的计算集群、存储集群及外置存储集群进行便捷的管理和维护，同时平台可对集群进行权限控制，用于将部分物理资源独享给一个或部分租户使用，适用于专属私有云场景。

## 4.1 计算集群

计算集群是一组配置、用途相同的计算节点（物理机）组成，用于部署并承载平台上运行的虚拟计算资源。一个数据中心可部署多个不同类型的计算集群，如 X86 集群、ARM 集群、GPU 集群等，不同的集群可运行不同类型的虚拟机资源，如 GPU 集群可为租户提供 GPU 虚拟机，ARM 集群可为租户提供基于 ARM 或国产化 OS 的虚拟机。

为保证虚拟机高可用，平台基于集群纬度提供虚拟化智能调度策略，包括打散部署、在线迁移及宕机迁移，即虚拟资源可在集群内的所有计算节点中进行调度、部署及迁移，提升业务的可用性。

* 打散部署是指平台租户创建虚拟机时默认会将创建的虚拟机尽量打散部署于集群内的所有节点上，保障硬件或软件故障等异常情况下租户业务服务的可用性。
* 在线迁移是指平台管理员手动将一台虚拟机从集群的一个物理机迁移到另一台物理机，释放源物理机的资源。
* 宕机迁移是指运行虚拟机的物理机出现异常或故障导致宕机时，调度系统会自动将其所承载的虚拟资源快速迁移至集群内健康且负载正常的物理机，尽量保证业务的可用性。

基于在线迁移和宕机迁移的逻辑，通常在部署上推荐将相同 CPU 和内存配置的物理机节点规划为一个计算集群，避免因 CPU 架构或配置不一致，导致虚拟机迁移后异常或无法启动。

默认情况下平台会根据 CPU 平台架构设定集群名称，管理员可根据平台自身使用情况修改集群名称；同时支持管理员查看并管理计算集群及计算集群内的物理机和计算实例，如修改集群权限、在线迁移计算实例等。

### 4.1.1 查看计算集群

通过导航栏的【集群】中的【计算集群】可进入平台计算集群管理控制台，也可通过【地域详情】中的【计算集群】进行特定地域的计算集群管理。

管理员可通过计算集群控制台查看特定地域的所有计算集群列表及信息，包括集群 ID、集群类型、集群类型名称、CPU 总核数、已分配核数、GPU 颗数、已分配 GPU 颗数、总内存、已分配内存及创建时间，如下图所示：

![computesetlist](../images/adminguide/computesetlist.png)

- 集群 ID ：集群在平台的唯一标识符，如 set-01、set-02 。 
- 集群类型名称：标志集群的名称，即在租户端的机型，租户在创建虚拟机时可选择不同的集群部署虚拟机。
- CPU 总核数 ：集群中总 vCPU 核数，即平台用户在集群中可申请的 vCPU 核数。
- 已分配核数 ：集群下已分配的 vCPU 核数，即平台用户在集群中已申请的 vCPU 核数。
- GPU 总颗数：集群中所有物理节点上的所有 GPU 设备总颗数。
- 已分配颗数：集群中已分配的 GPU 颗数。
- 总内存（GB）：集群中总的内存容量，即平台用户在集群中可申请的内存容量。
- 已分配内存（GB）：地域下已分配到总内存容量，即平台用户在集群中已申请的内存容量。
- 创建时间 ：计算集群的创建时间

> 如一个集群已分配的 vCPU 和内存比例超过 80% 以上，代表地域下可用 vCPU 和内存资源较少，通常需要进行扩容；也可统计租户云资源使用率并及时释放云资源，确保真正需要使用资源的用户可分配到云资源。

管理员也可通过列表集群名称或列表后的详情按钮进入集群详情页面，查看计算集群概览信息，并对集群中包括的物理及所有计算实例进行管理。

（1）计算集群概览页面展示计算集群的基本信息和监控信息：

* 基本信息主要展示集群ID、集群类型名称、总核数、已分配核数、总内存、已分配内存等信息。
* 监控信息主要展示集群下 CPU 核数的使用趋势（包括总量、已分配、未分配）、内存容量使用趋势（包括总量、已分配、未分配）。

（2）物理机管理是指对集群内的所有计算节点的管理，如对物理机进行锁定、进入维护模式等，详见物理资源管理中的[物理机管理]()章节。

（3）计算实例管理是指对集群内所有计算实例的管理，如在线迁移，详见[计算实例管理]()章节。

### 4.1.2 修改集群类型名称

集群类型即代表一个集群，默认情况下平台会根据 CPU 平台架构设定集群名称，平台管理员可根据平台使用需求，为计算集群命名更有标志性的名称。

修改集群类型名称后，用户在创建虚拟资源时选择的机型名称会同步为集群名称。修改名称不影响集群和资源的正常运行，在任何情况下均可修改。管理员可在计算集群列表点击“修改集群类型名称”，输入新名称即可更改集群类型名称，如下图所示：

![renameset](../images/adminguide/renamesetname.png)

> 平台上计算集群类型和集群名称为一个概念，即一个集群类型即代表一个集群。

### 4.1.3 修改集群权限

平台的计算集群默认对所有租户开放权限，平台支持对计算集群进行权限控制，用于将部分物理计算资源独享给一个或部分租户使用，适用于专属私有云场景。修改集群权限后，集群仅可对指定的租户开放并使用，无权限的租户无法查看并使用受限的集群创建虚拟资源。

在应用场景上，可将特殊机型的物理服务器集群、GPU 物理服务器集群仅对少部分租户开放权限，使一部分租户的关键业务仅运行在指定的集群中。假设目前有 50 台计算存储超融合物理机，针对 ABCD 四个用户中 A 独享 30 台物理机的场景，解决方案如下所示：

![setscene](../images/adminguide/setscene.png)

为满足租户可独享部分物理机，在部署平台规划物理资源时，需要将独享物理机划分至一个独立的计算集群，同时需将独享物理机上的存储资源划分至一个独立的存储集群，并将划分的计算和存储集群分配给独享租户，以保证划分给租户的计算及存储资源为相同的独享物理机。

- 在部署平台时，将 30 台物理服务器规划至同一个计算集群（计算集群 1），保证其余 20 台服务器划入不同的计算集群（计算集群2）。
- 同时将 30 台物理服务器上的磁盘资源规划至同一个存储集群类型（存储集群1），保证其余 20 台存储资源划入不同的存储集群（存储集群2）。

通过上述的方案，在物理层面和平台逻辑层面，将 30 台物理服务器的计算资源和存储资源划入了独立的资源池，即而通过平台的 【集群类型权限】将 计算集群1 和 存储集群1 的使用权限配置为 A 租户。

此时 A 租户在创建虚拟机、磁盘、快照、负载均衡、NAT 网关及 VPN 网关实例时可以选择【计算集群1】机型和 【存储集群1】存储类型，BCD 租户创建资源时无法查看到计算集群 1 和存储集群 1 ，继而无法在该独享集群上创建相关资源，保证计算集群 1 和存储集群 1 的计算存储资源被 A 租户独享。

平台管理员可在计算集群列表点击【修改集群类型权限】，指定租户权限为“所有租户”或“指定租户”，即可将集群划分给指定的租户，如下图所示：

![setscene1](../images/adminguide/setscene1.png)

默认权限为所有租户，即平台所有租户默认均可部署虚拟资源至所有集群；当用户为集群设置租户权限为指定租户时，仅指定的租户可查看并部署虚拟资源至集群。

### 4.1.4 计算实例管理

计算实例管理是指平台管理员对计算集群内所有计算实例的管理，包括平台租户在集群中部署的虚拟机实例及负载均衡、NAT 网关、VPN 网关等 PaaS 产品的计算实例。平台提供计算实例的生命周期管理，包括查看计算实例、在线迁移、宕机迁移等，管理员可通过计算实例了解集群资源的具体情况。

#### 4.1.4.1 查看计算实例

管理员可通过【计算集群】列表进行详情页面，切换至“计算实例”标签，即可查看和管理计算集群下的计算实例列表及相关信息，包括计算实例的名称、实例 ID、资源 ID、所属租户、物理机、镜像 ID、GPU、CPU、内存、状态、创建时间及更新时间，如下图所示：

![cilist](../images/adminguide/cilist.png)

- 名称：计算实例对应的资源名称，当计算实例为虚拟机时展示虚拟机名称，当计算实例为 PaaS 产品的一个实例时展示 PaaS 产品的资源名称，如 `lb001` 。
- 计算实例 ID：计算实例在所对应的底层计算实例标识符。
- 资源 ID：计算实例所对应资源在平台的标识符。
- 所属租户：计算实例的所属租户邮箱。
- 物理机 IP：部署计算实例的宿主机 IP 地址，由于计算实例关机后即不占用 CPU 和内存资源，因此计算实例关机时物理机 IP 为空。
- 镜像 ID：计算实例所使用操作系统镜像 ID 。
- GPU：计算实例的 GPU 颗数。
- CPU：计算实例的 vCPU 核数。
- 内存：计算实例的内存容量。
- 状态：计算实例的状态，包括创建中、启动中、运行中、关机、断电中、重装系统中、删除中及迁移中，其中迁移中包括在线迁移和宕机迁移。
- 创建时间：计算实例的创建时间。
- 更新时间：计算实例的更新时间。

#### 4.1.4.2 在线迁移

在线迁移是计划内的迁移操作，即虚拟机划计算实例不停机的情况下，在不同的物理机之间进行在线跨机迁移。通过在线迁移可平衡计算节点负载、将相互通信的虚拟机迁移至一个计算节点、将多个虚拟机分散到不同的计算节点等多种场景，提高平台及业务的可用性和可靠性。

在线迁移的过程首先会在目标物理机注册一个相同配置的虚拟机进程，然后进行计算实例内存数据同步，最终快速切换业务到目标实例。整个迁移切换过程非常短暂，几乎不影响或中断用户运行在实例中的业务，适用于云平台资源动态调整、物理机停机维护、优化服务器能源消耗等场景，进一步增强云平台可靠性。

计算实例的在线迁移支持随机分配和指定物理节点两种模式，以适应不同场景的迁移任务：

* 随机分配：是指平台根据集群内计算节点的负载情况，随机分配物理机作为计算实例迁移的目标节点。
* 指定物理节点：是指实例迁移有明确的目标节点，平台将指定的节点作为计算实例迁移的目标节点。

管理员可根据具体场景需求，选择适合的迁移模式，默认为指定物理节点模式。若迁移有明确的目标节点，如虚拟机当前所在物理机器负载过高，迁移到已知的负载较低的物理节点上，可选择指定物理节点迁移模式，并根据物理机 IP 选择目标节点；若无明确目标节点，可选择随机分配迁移模式，系统将自动选定合适的物理节点。在线迁移的前提条件如下：

- 计算实例为正常运行状态。
- 实例所在集群有足够的资源满足迁移需求。
- 计算实例未挂载 GPU 设备，即不支持迁移 GPU 虚拟机。
- 虚拟机所部署的业务不存在频繁读写操作，否则可能导致迁移过程缓慢或无法完成。

管理员可通过【计算实例】列表操作项的【迁移】进行在线迁移操作，指定迁移模式和目标节点即可进行实例的迁移，如下图所示：

![instancemigrte](../images/adminguide/instancemigrate.png)

在线迁移仅支持在相同的计算集群内迁移，迁移过程中实例的状态变更为“迁移中”，待迁移成功后转换为“运行中”状态。**在线迁移过程中，会迁移源实例的全量及增量内存数据，待内存数据反复迭代完成数据同步时，即可迁移完成。**

#### 4.1.4.3 宕机自动迁移

宕机迁移又称离线迁移（Offline Migration）或虚拟机高可用（ High Availability），指平台底层物理机出现异常或故障而导致宕机时，调度系统会自动将其所承载的虚拟资源快速迁移到健康且负载正常的物理机，尽量保证业务的可用性。

整体宕机迁移不涉及存储及数据迁移，新的计算实例可快速在新物理机上运行，平均迁移时间为 90 秒左右，可能会影响或中断运行在虚拟机中的业务。宕机迁移为平台智能调度系统自动触发行为，整个过程无需人工干预，管理员可通过计算实例列表的状态查看宕机迁移过程，宕机迁移过程中实例的状态为“迁移中”，待计算实例成功在健康的节点启动并正常运行后，实例的状态流转为“运行中”。

平台基于集群纬度提供计算实例的宕机迁移，即计算实例所属物理机发生故障时，只会将计算实例重新部署至集群内的健康且负载正常的物理机节点。通常在部署上推荐将相同 CPU 和内存配置的物理机节点规划为一个计算集群内，避免因 CPU 架构或配置不一致，导致虚拟机迁移后异常或无法启动。

### 4.1.5 集群物理机管理

集群物理机管理是指管理员对集群内的所有计算节点的管理，如对物理机进行锁定、进入维护模式等。集群物理机管理相关操作与资源管理中物理机管理一致，区别仅在于集群物理机管理是对本集群内的计算节点进行管理，资源管理中的物理机管理是对地域内所有计算节点进行管理，具体管理操作详见【资源管理】中的[物理机管理]()章节。

## 4.2 存储集群

存储集群平台默认提供的分布式存储集群，通常由一组配置相同的存储节点（物理机）组成，用于部署并承载分布式存储资源。一个数据中心可部署多个不同类型的存储集群，如 SSD 集群、SATA 集群、容量型集群、性能型集群等，不同的集群可提供不同类型的云盘源，如 SSD 存储集群可为租户提供 SSD 类型的云硬盘。

平台通过分布式存储集群体系结构提供基础存储资源，并支持在线水平扩容，同时融合智能存储集群、多副本机制、数据重均衡、故障数据重建、数据清洗、自动精简配置及快照等技术，为虚拟化存储提供高性能、高可靠、高扩展、易管理及数据安全性保障，全方面提升存储虚拟化及云平台的服务质量。

分布式存储集群默认支持 3 副本策略，写入数据时先向主副本写入数据，由主副本负责向其他副本同步数据，并将每一份数据的副本跨磁盘、跨服务器、跨机柜分别存储于不同磁盘上，多维度保证数据安全。在存储集群中存储服务器节点无网络中断或磁盘故障等异常情况时，副本数据始终保持为 3 副本，不区分主副本和备副本；当存储节点发生异常副本数量少于 3 时，存储系统会自动进行数据副本重建，以保证数据副本永久为三份，为虚拟化存储数据安全保驾护航。

平台支持管理员对存储集群进行管理，包括查看存储集群、修改集群类型名称及修改集群权限等，可通过管理控制台存储集群页面进行管理。

### 4.2.1 查看存储集群

地域可部署不同类型的存储集群，如 SSD、SATA、SAS 等，通常根据存储介质或存储用途设定集群名称，管理员也可根据部署环境信息修改集群名称。通过导航栏的【集群】中的【存储集群】可进入平台存储集群管理控制台，也可通过【地域详情】中的【存储集群】进行特定地域的存储集群管理。

管理员可通过存储集群控制台查看特定地域的所有存储集群列表及信息，包括集群 ID、集群类型、集群类型名称、总存储、已使用存储及创建时间，如下图所示：

![storagesetlist](../images/adminguide/storagesetlist.png)

- 集群ID：存储集群平台全局唯一标识符，如 storage-set-01。
- 集群类型：存储集群的类型。
- 集群类型名称：标志存储集群类型的名称，即在租户端的磁盘类型，租户在创建虚拟机时可选择不同的存储类型创建云硬盘，一个存储集群类型中包知多个存储集群，
- 总存储：代表存储集群的总容量，单位为 GB 。
- 已使用存储：存储集群的已使用容量，即平台用户已申请的存储容量，单位为 GB 。
- 更新时间：存储集群的更新时间

> 注：已使用存储指平台租户已申请的存储容量，不代表存储集群的真实使用量。

### 4.2.2 修改集群类型名称

默认情况下平台会根据存储介质或存储用途设定集群名称，平台管理员可根据平台使用需求，为存储集群命名更有标志性的名称。

修改集群类型名称后，用户在创建云硬盘时选择的磁盘类型会同步为集群类型名称。修改名称不影响集群和资源的正常运行，在任何情况下均可修改。管理员可在存储集群列表点击“修改集群类型名称”，输入新名称即可更改集群类型名称，如下图所示：

![renameset](../images/adminguide/renameset.png)

### 4.2.3 修改集群权限

平台的存储集群默认对所有租户开放权限，平台支持对存储集群进行权限控制，用于将部分物理存储资源独享给一个或部分租户使用，适用于专属私有云场景。修改集群权限后，集群仅可对指定的租户开放并使用，无权限的租户无法查看并使用受限的集群创建云盘资源。

为满足租户可独享部分物理机，在部署平台规划物理资源时，需要将独享物理机划分至一个独立的计算集群，同时需将独享物理机上的存储资源划分至一个独立的存储集群，并将划分的计算和存储集群分配给独享租户，以保证划分给租户的计算及存储资源为相同的独享物理机。

平台管理员可在存储集群列表点击【修改集群类型权限】，指定租户权限为“所有租户”或“指定租户”，即可将集群划分给指定的租户，如下图所示：

![setscene2](../images/adminguide/setscene2.png)

默认权限为所有租户，即平台所有租户默认均可在所有存储集群上创建并使用云盘资源；当用户为集群设置租户权限为指定租户时，仅指定的租户可查看并使用集群的存储资源。

##  4.3 外置存储

### 4.3.1 产品简介

云平台默认提供分布式存储作为虚拟化的后端存储，为云平台用户提供高可用、高性能、高可靠及高安全的存储服务。同时云平台虚拟化支持对接商业存储设备，如 IPSAN 等存储阵列，为云平台虚拟机提供集群中高性能块存储服务，同时可利旧企业用户的集中存储设备，整体节省信息化转型的总拥有成本。

外置存储服务是云平台为企业用户提供的商业存储服务，通过 ISCSI 协议对接商业存储，将商业存储作为虚拟化后端存储池，提供存储池管理及逻辑卷分配，可直接作为虚拟机的系统盘及数据盘进行使用，即只要支持 ISCSI 协议的存储设备均可作为平台虚拟化的后端存储，适应多种应用场景。

平台支持存储设备的对接和管理，并支持将存储设备中的 LUN 分配给租户，由租户将 LUN 分配或挂载至虚拟机的系统盘或数据盘，进行数据的读写，具体功能特性如下：

* 支持存储设备资源池的录入管理，并支持一键扫描 ISCSI 设备中已创建的 LUN 存储卷信息。
* 支持将已扫描的 LUN 存储卷分配给平台租户，使租户有权限使用磁盘作为虚拟机的系统盘或数据盘。
* 支持租户将有权限的 LUN 存储卷信息作为虚拟机的系统盘，使虚拟机直接运行直商业存储中，提升性能。
* 支持租户将有权限的 LUN 存储卷信息作为虚拟机的数据盘。
* 支持将存储卷重新分配给平台其它租户。

基于以上功能特性，平台可支持直接使用商业存储设备作为虚拟化的后端存储，为虚拟机提供传统商业存储设备的存储空间，同时不影响商业存储中的其它 LUN 为其它业务提供存储服务。

平台基于 ISCSI 协议对接商业存储，在对接中需要将存储设备的 LUN 映射到平台计算节点，使平台计算节点上运行的虚拟机可直接使用映射的 LUN ；同时为保证虚拟机的高可用，需要将 LUN 同时映射到一个集群内的所有计算节点，即所有计算节点均可挂载并使用映射的存储卷，以保证宕机迁移时可在每个计算节点挂载该存储卷信息。

* 当虚拟机所在的计算节点故障时，平台会自动触发虚拟机宕机迁移，即将虚拟机迁移至计算集群内正常的计算节点上，使虚拟机可正常提供服务。
* 虚拟机使用的 LUN 存储卷已被映射到集群内所有计算节点，当虚拟机在集群内迁移至新节点后，可直接使用已映射的 LUN 存储启动虚拟机的系统盘或数据盘，并正常挂载至虚拟机，保证虚拟机迁移后业务正常。

平台仅将商业存储的 LUN 作为存储卷进行使用，不对存储卷本身进行管理，如 LUN 的创建、映射、扩容、快照、备份、回滚、克隆等。

### 4.3.2 使用流程

在使用外置存储前，需要平台管理者或存储设备管理者，将外置存储与平台的计算节点网络打通，使计算节点可与存储设备间直接内网可互相通信。

物理存储设备及网络准备好后，即可与平台进行对接并使用平台提供的外置存储服务，整个对接过程需要存储设备管理员、平台管理员及平台租户三个角色进行操作，其中与平台相关的为平台管理员和平台租户的操作，如下图流程所示：

![storageflow](../images/adminguide/storageflow.png)

1. **存储设备管理员管理存储卷**

   所有存储卷的管理均由存储设备管理员自行在商业存储的管理系统上进行操作，包括存储卷（Lun）的创建和映射，同时包括存储卷的扩容、快照、备份及删除等相关生命周期管理。

2. **存储设备管理员映射存储卷至集群计算节点**

   创建好的 Lun ，由存储设备管理员在存储设备上映射到所有计算节点（如果新增计算节点，需再次进行映射），同时也可进行多路径映射。

3. **平台管理员录入并管理存储设备**

   存储卷 LUN 映射成功后，由【平台管理员】在管理控制台“外置存储集群”中进行 ISCSI 存储池或存储设备的录入，录入时需要指定存储设备的 ISCSI 地址，如 172.18.12.8:8080 。

4. **平台管理员扫描已映射的 LUN 信息**

   录入的存储设备后，由【平台管理员】在存储设备中一键扫描 ISCSI 存储设备中已被映射至集群节点上的存储卷设备及信息。

5. **平台管理员为租户分配 LUN 设备**

   由【平台管理员】将扫描成功的 LUN 存储卷设备指定给租户，一个存储卷同一时间仅支持分配给一个租户，分配后租户在外置存储设备中即可查询已分配的存储卷设备，并可进行创建虚拟机或挂载虚拟机。

6. **平台租户使用 LUN 存储卷设备**

   平台租户通过控制台外置存储可直接查询已分配的存储卷，并在创建虚拟机时指定系统盘类型为外置存储，或者也可直接将 LUN 存储卷直接挂载给已有虚拟机，作为虚拟机的数据盘进行使用。

平台租户使用外置存储服务的前提是存储卷已映射并分配给租户，租户只需要简单的绑定即可便捷的使用平台提供的外置存储设备，并可进行弹性绑定和解绑。

### 4.3.3 添加外置存储

平台用户在使用外置存储前，需要管理员在控制台添加外置存储到云平台，添加时需要指定商业存储的 ISCSI 地址，即平台连接商业存储的 ISCSI 入口，通常以 IP 和端口组成。添加外置存储时支持为一个存储商务添加多个 ISCSI 地址，适用于商业存储的多路径访问，保证 LUN 存储访问的可用性。

管理员可通过导航栏中的集群进入集群管理，切换至外置存储控制台进行外置存储页面，通过【新建】操作进入添加外置存储向导页面，如下图所示：

![addstorage](../images/adminguide/addstorage.png)

* 名称：外置存储的名称，添加时必须指定。
* ISCSI 地址：外置存储的 ISCSI 连接地址，格式为 IP:Port ，支持添加多个 ISCSI 地址，如 172.16.13.201:3260 和 172.16.13.202:3260 。

添加后外置存储列表会生成一条外置存储信息，可查看外置存储的信息及已映射到平台的 LUN 存储卷信息。

### 4.3.4 查看外置存储

支持管理员查看外置存储的列表信息，包括名称、资源 ID、ISCSI 地址、LUN 数量及操作项，如下图所示：

![storagelist](../images/adminguide/storagelist.png)

* 名称：外置存储的名称和标识，租户端在创建虚拟机时系统盘类型处显示的名称。
* 资源 ID ：外置存储在平台的全局唯一标识符。
* ISCSI 地址：外置存储的 ISCSI 连接地址，可以为多个。
* LUN 数量：外置存储中已映射到平台上的 LUN 存储卷数量。

列表上可支持对每个外置存储进行删除操作，并可点击详情进入外置存储查看并管理商业存储的 LUN 存储卷。

### 4.3.5 扫描 LUN 存储卷

外置存储添加至云平台后，需要平台管理员对存储设备中已映射至平台的 LUN 存储卷进行一键扫描，使平台可获取可使用的 LUN 设备信息。

平台管理管理员可通过外置存储详情【LUN存储卷】列表上的【扫描】按钮进行 LUN 存储卷的扫描，触发扫描后，商业存储设备管理员映射至平台计算节点的 LUN 存储卷将会展示至 LUN 存储卷列表中，可通过列表信息查看 LUN 存储卷的信息，并将存储卷分配级指定的租户，用于创建虚拟机或作为数据盘挂载至虚拟机。

> 当存储设备管理员在存储设备上新增 LUN ，并将 LUN 映射到平台后，可重新通过扫描发现新映射的存储卷，并可将新的存储卷分配给租户，进行虚拟机的创建和数据盘挂载。

### 4.3.6 查看存储卷信息

管理员可通过外置存储详情中的【LUN 存储卷】列表查看已扫描出的存储卷信息，包括 LUNID、资源 ID、容量、状态、挂载资源、所属租户及操作项，如下图所示：

![lunlist](../images/adminguide/lunlist.png)

* LUNID：LUN 存储卷在商业存储中的唯一标识符。
* 资源 ID：存储卷在平台的唯一标识符。
* 容量：当前 LUN 存储卷的容量大小。
* 状态：当前 LUN 存储卷的状态，包括未绑定、绑定中、已绑定、解绑中。
* 挂载资源：LUN 存储卷已挂载的虚拟机 ID ，未绑定时为空。
* 所属租户：LUN 存储卷已分配的租户邮箱地址。

通过列表上操作项，支持对每一个 LUN 存储卷信息进行租户分配操作，即将存储卷分配给一个租户。

### 4.3.7 分配存储卷给租户

支持平台管理员将商业存储中已扫描的的 LUN 存储卷信息分配给一个租户，使租户有权限使用 LUN 作为虚拟机的系统盘或数据盘。支持修改存储卷的所属租户，即将存储卷从一个租户重新分配给另一个租户。一个存储卷同一时间仅支持分配给一个租户且同一时间仅支持挂载至一台虚拟机。

管理员可通过 LUN 存储卷列表上的【分配】操作，将一个 LUN 存储设备分配给一个租户，如下图所示：

![Assignlun](../images/adminguide/Assignlun.png)

管理员也可通过分配操作将一个存储卷重新分配给另一个租户，仅支持未绑定状态的 LUN 设备重新分配租户。

### 4.3.8 删除外置存储

平台支持管理员删除外置存储，删除前扫描出的所有 LUN 设备必须为未绑定状态。可通过外置存储资源列表操作项中的删除对外置存储进行删除，如下图所示：

![rmstorage](../images/adminguide/rmstorage.png)

外置存储删除仅表示设备从平台进行释放，可通过录入 ISCSI 地址重新添加存储设备到云平台。

# 5 物理资源管理

平台为管理员提供全平台所有物理资源的生命周期管理和运维能力，使平台管理员可通过控制台统一管控运行云平台的整体物理资源，包括物理机资源（宿主机）、物理机纳管、镜像资源及外网网段资源。

## 5.1 物理机管理

物理机管理是指对地域内的所有计算节点的管理，包括查看物理机、锁定、解锁、进入维护模式、退出维护模式等，同时可查看每个计算节点中已存在的计算实例。

### 5.1.1 查看物理机列表

管理员可在计算资源/物理机页面查看地域下所有物理机节点列表及相关信息，包括物理机 ID、物理机 IP、计算集群 ID、CPU 类型、总核数、已分配核数、总内存、已分配内存、状态、更新时间及操作项，如下图所示：

![computenode](../images/adminguide/computenode.png)

- 物理机 ID：计算节点在平台的唯一标识符。
- 物理机 IP：计算节点的 IP 地址。
- 计算集群 ID：计算节点所属计算集群的 ID。
- CPU 类型：计算节点的 CPU 类型，如 Intel、AMD 等。
- 总核数：计算节点的总 vCPU 核数。
- 已分配核数：计算节点中已分配的核数。
- 总内存：计算节点的总内存容量，如 256GB。
- 已分配内存：计算节点中已分配的内存容量。
- 更新时间：计算节点的更新时间。
- 状态：计算节点的运行状态，包括可用、已锁定、进入维护模式中、维护模式。
  - 可用：代表计算节点可提供计算服务，计算实例会被调度并部署至物理机。
  - 已锁定：代表计算节点已被锁定，新建计算实例不会被调度至计算节点，不影响节点内已有计算实例。
  - 进入维护模式中：代表计算节点正在进入维护模式中，即物理机上的虚拟资源将被自动迁移到同计算集群的其他节点，使计算节点进入维护模式。
  - 维护模式：代表计算节点上的所有计算实例已被迁移至同集群其它节点并已正常进入维护模式，可对节点进行维护，如扩展内存、升级、修复硬件等。

管理员可在列表上对每台计算节点进行锁定、解锁、进入维护模式、退出维护模式等操作，以方便对计算节点进行维护；同时支持对物理机节点进行搜索，支持模糊搜索。

### 5.1.2 查看物理机详情

管理员可在物理机列表中，通过目标物理机器名称或者右侧的“详情”按钮进入物理机器详情页面，查看物理机的基本信息及监控信息，同时可查询计算节点已运行的计算实例，如下图所示：

![computenodeinfo](../images/adminguide/computenodeinfo.png)

**（1）基本信息**

包括物理机 ID、物理机 IP 地址、集群 ID、CPU 类型、状态、总核数、已分配核数、总内存、已分配内存及更新时间。

**（2）监控信息**

支持查看物理机器的监控信息，包括：网卡入带宽、网卡出带宽、硬盘读吞吐、硬盘写吞吐、平均负载、内存使用率、空间使用率、硬盘读此书、网卡入包量、硬盘写次数、网卡出包量、CPU 使用率、TCP 连接数、阻塞进程数。

**（3）计算实例**

支持管理员通过物理机详情页面，查看物理机中的计算实例列表及信息，包括名称、计算实例 ID、资源 ID、所属租户、物理机 IP、镜像 ID、GPU、CPU、内存、状态、创建时间及更新时间，并支持对计算实例进行搜索，支持模糊搜索，如下图所示：

![nodeinstance](../images/adminguide/nodeinstance.png)

计算实例包括虚拟机的实例，同时也包括平台网关及 PaaS 产品的实例，可通过实例名称及资源 ID 进行区分。

### 5.1.3 锁定物理机

物理机被锁定后，新建计算实例不会被调度至计算节点，不影响节点内已有计算实例，可配合物理机进入维护模式功能，以实现物理机维护、升级等操作。

![lock](../images/adminguide/lock.png)

仅支持物理机在【可用】状态下进行锁定操作，锁定物理机后，物理机的状态即流转为【已锁定】，在已锁定状态下新的虚拟机实例不会被创建至节点，同时可在已锁定状态下使计算节点进入维护模式。

> 锁定物理机为敏感操作，可能导致租户创建资源失败，操作前需确认平台有足够的资源。

### 5.1.4 解锁物理机

管理员将锁定的物理机进行解锁，可对外提供计算服务，计算实例可被调度并部署至物理机。

![unlock](../images/adminguide/unlock.png)

仅支持物理机在【已锁定】状态下进行解锁操作，解锁后物理机的状态即流转为【可用】，在可用状态下计算实例会被调度并创建至节点。

### 5.1.5 进入维护模式

当需要维护物理机时，比如扩展内存、升级、修复硬件等维护场景下，平台支持将物理机进入维护模式，使物理机上的虚拟资源自动迁移至同计算集群中其他物理节点上，使节点处于空闲状态，确保对物理节点维护时不影响平台的虚拟资源运行，保证业务的可用性。

物理机进入维护模式前必须保证节点状态为已锁定，即需要将物理机进行锁定，才可进行【进入维护模式】的操作，如下图所示：

![maintenance](../images/adminguide/maintenance.png)

管理员将物理机锁定并进入维护模式前，需请执行以下检查：

* 物理机上是否有不可迁移的资源，如 GPU 虚拟机或处于中间状态的虚拟机。
* 若存在不可迁移的资源，物理机器可进入进入维护模式，但中间状态的虚拟机和GPU虚拟机无法被迁移成功。
* 集群内空闲资源是否足够迁移当前物理机的所有计算实例。

确保物理机可进入维护模式时，可通过物理机列表操作项进行操作，具体步骤如下：

1. 选择目标物理机器，点击右侧“锁定”按钮，使物理机进入已锁定状态；

2. 点击“进入维护模式”按钮，将物理机器进入到维护模式，物理机将自动流转为“进入维护模式中”状态，如下图所示：

   ![inmaintain](../images/adminguide/inmaintain.png)

3. 系统会自动执行在线迁移功能，将此物理机器上的资源随机迁移至本计算集群中其他合适的物理机节点，关机状态的计算实例在下次启动后会自动调度至其它物理机。

4. 待所有虚拟计算实例被迁移至其它节点后，物理机节点将自动进入【维护模式】状态。

> 如果物理机器上有无法被成功迁移的资源，进入维护模式将被中断，物理机器将停留在锁定状态。您可以继续执行物理机进入维护模式操作，再次尝试迁移未被成功迁移的资源。

### 5.1.6 退出维护模式

退出维护模式是指将物理机重新加入至调度系统，为平台提供计算能力。仅支持状态为【维护模式】的物理机退出维护模式，退出维护模式，物理机将会自动恢复并进入至锁定状态，需进行解锁才可加入智能调度系统以提供计算能力。

平台管理员可通过物理机节点列表操作项中的【退出维护模式】按钮进行操作，如下图所示：

![outmaintain](../images/adminguide/outmaintain.png)

退出维护模式后，物理机节点的状态会自动流转为【已锁定】状态，需通过解锁操作使物理机可正常提供服务。

## 5.2 物理机纳管

### 5.2.1 概述

物理机纳管是平台为用户应用提供专属物理服务器的服务，可保证核心数据库、关键应用系统、高性能计算业务及暂时无法云化业务的高性能和稳定性。

结合云平台对资源的弹性管理，可实现物理机的按需分配、灵活申请、自动安装操作系统，同时结合 IPMI 和 PXE 可支持物理机设备的批量部署，并通过自动化系统配置，实现远程批量启动和部署。支持自定义安装物理机设备的操作系统及网络自助配置，并提供物理服务器生命周期管理，包括服务器的启动、关机及释放等。

平台通过部署服务器提供 PXE 远程自助装机服务，引导相同网络中多台物理服务器由 PXE 网络启动，通过部署服务器下载并安装操作系统软件包为物理机安装操作系统，并根据操作系统配置的网络模板信息，配置服务器网络信息，将服务器与平台外网网络打通，结合平台统一管理服务，使用户通过平台即可自助申请并管理物理服务器。具体价值举例如下：

* 通过物理机纳管服务，平台租户可将虚拟机和物理机混合部署，构建异构基础设施的统一管理和灵活组网，物理机的网络可与平台虚拟机的外网网络互通，满足虚拟机业务与物理机互访等场景的诉求。
* 租户可根据需求自助申请平台管理者提供的物理机，并独享物理服务器的计算、网络及本地磁盘资源，可充分满足对高性能、稳定性、数据安全性的要求；结合物理服务器的独享网络，可满足对网络的低时延和高吞吐业务场景。

租户通过申请平台的物理机，可应用于核心数据库、大数据服务及关键应用等应用场景，如可将数据库集群 OracleRAC 部署于平台纳管的物理机，将业务应用部署于平台虚拟机，并使用虚拟机的外网 IP 与物理机直接通过物理设备进行互联，提升业务性能和稳定性的同时提升资源管理的便捷性。

### 5.2.2 使用流程

在使用物理机纳管服务前，必须提前准备好物理机设备，并根据需求将物理服务器的 IPMI 网络及业务网络与平台网络进行打通，在通过平台录入设备信息，将设备分配给租户，由租户自助申请后，自动安装操作系统并配置服务器网络。物理机纳管服务的使用流程分为【平台管理员流程】和【租户流程】两大部分，其中前 6 步为平台管理员进行操作，具体如下：

1. **硬件环境装备**

   准备好硬件环境，配置物理网络交换机及服务器 IPMI 网络，使平台物理网络与 IPMI 网络可互相通信。

2. **管理物理机资源池**

   由【平台管理员】创建并管理物理机资源池，用于定义一批物理机服务器操作系统使用的网段及 Vlan 信息，同时也用于定义网卡配置模板。

3. **管理网卡配置模板**

   由【平台管理员】创建并管理网卡配置模板，用于定义一批物理机服务器操作系统具体的网卡配置信息，如双网卡聚合及网卡使用的 Vlan 和 CIDR 网段，可在安装操作系统时根据模板自动配置网卡并配置 IP 等信息。

4. **为资源池添加物理机**

   由【平台管理员】为物理机资源池添加物理机信息，包括服务器的 SN 序列号、IPMI 用户名、密码及服务器操作系统的网卡模板，支持批量导入物理机信息。

5. **PXE 引导初始化**

   物理机信息录入后，如果 IPMI 网络及登录信息可正常访问，平台将通过 IPMI 和 PXE 自动引导录入的物理机重新启动并进行平台准备好的部署系统并对服务器进行初始化。初始化过程中物理机的状态为【准备中】，待服务器初始化成功后，服务器的状态置为【正常】，此时可在物理机的详情中查看物理服务器的详细硬件配置，如 CPU、内存、磁盘信息、网卡信息等。

6. **物理服务器分配**

   由【平台管理员】将已初始化的已纳管的物理服务器分配给租户，一个物理机同一时间仅支持分配给一个租户，有权限的租户可至控制台自助申请物理机并安装操作系统。

7. **租户申请物理机**

   由【平台租户】通过控制台物理机功能，根据需求自助申请有权限的物理机，可指定需要申请的特定物理机，并可指定物理机的系统盘、操作系统、IP 地址及管理员登录密码。

8. **自动化装机**

   平台根据用户指定的系统盘及操作系统，通过 PXE 远程自动安装操作系统，并在系统安装成功后，根据申请时指定的配置信息自动配置网络及密码，使用户可管理已安装好的物理机。

9. **纳管物理机管理**

   由【平台租户】对已申请的物理机进行全生命周期管理，支持重装系统、关机、开机，并可在不用物理机时将设备重新释放给平台，由平台重新分配给其它租户。

平台租户在使用物理机纳管服务的前提是物理机准备好并分配给租户，租户只需要简单的申请，即可便捷的使用平台提供的裸金属设备，并可灵活部署业务系统至物理机设备，组建混合异构的基础设施环境。

### 5.2.3 物理机资源池

物理机资源池用于定义一批物理机服务器操作系统使用的网段及 Vlan 信息，可在一个资源池中添加多台物理机，每台物理机可绑定网卡模板，用于配置物理机安装操作系统后的网卡配置，如网卡聚合配置、子接口配置等。

平台管理员可对物理机资源池进行全生命周期管理，包括创建资源池、查看资源池信息、修改资源池、删除资源池，同时可为资源池添加物理机，并管理已添加的物理机，如修改物理机网卡模板、移除物理机、修改物理机信息等，通过一系列配置后租户即可通过控制台申请并使用已配置好的物理机。

#### 5.2.3.1 添加资源池 

在使用物理机纳管服务时，需要管理先添加一个物理机资源池和网卡模板，并在资源池中添加物理机，同时为资源池中的物理机绑定网卡模板，准备物理机装机前的配置。

管理员可通过控制台导航栏【物理机纳管】进入物理机资源池列表页面，通过【创建资源池】指定资源池的名称、Vlan、网段及网关进行创建操作，如下图所示：

![createbmspool](../images/adminguide/createbmspool.png)

* 名称：资源池在平台的名称标识，如 Dell-pool 。
* Vlan ：资源池网段的所属 Vlan ，无 Vlan 时可为空。
* 网段：资源池内物理机操作系统网络所使用的网段，创建时必须指定，格式必须为网段，如 172.12.1.0/24 ，一个资源池仅支持配置一个 CIDR 网段。
* 网关：资源池网段的网关信息，可为空。

创建成功后，资源池的列表会生成一条资源池信息，管理员可通过资源池列表查看并管理物理机资源池。

#### 5.2.3.2 查看资源池

管理员可平台控制台查看物理机资源池的列表及相关信息，包括名称、资源 ID、Vlan、网段、网关、物理机数量及操作项，如下图所示：

![bmspoollist](../images/adminguide/bmspoollist.png)

* 名称：物理机资源池的名称标识。
* 资源 ID：物理机资源池的全局唯一标识符。
* Vlan：物理机资源池网段的所属 Vlan。
* 网段：物理机资源池的网段信息，CIDR 格式。
* 网关：物理机资源池网段的网关信息。
* 物理机数量：物理机资源池内已添加的物理机数量。

管理员可通过列表上操作项对资源池进行修改和删除操作，同时支持批量删除操作；管理员可通过详情按钮进入资源池的详情页面查看资源池的物理机信息，如下图所示：

![bmspoolinfo](../images/adminguide/bmspoolinfo.png)

通过详情页面管理员可查看物理机资源池的基本信息，同时可通过物理机模块进行资源池的物理机管理，其中基本信息包括名称、资源 ID、Vlan、网段、网关、物理机数量及申请时间。

资源池中的物理机模块可支持管理员在资源池内添加物理机、查看物理机信息、移除物理机、修改物理机、修改网卡模板等操作，同时支持管理员按照平台的规范批量导入物理机信息。

#### 5.2.3.3 修改资源池

支持平台管理员修改物理机资源池的信息，包括名称、 Vlan、网段、网关，如下图所示：

![updatebmspool](../images/adminguide/updatebmspool.png)

由于资源池的网段和 Vlan 信息会被资源池中的物理机使用，若物理机资源池中已添加物理机，则不允许修改 Vlan 和网段信息，可修改名称及网关信息。

#### 5.2.3.4 删除资源池

支持平台管理员删除物理机资源池，删除后租户将无法再申请和管理资源池中的物理机，但不影响已申请物理机的正常运行。管理员可通过物理机资源池列表操作项中的删除按钮进行资源池的删除，如下图所示：

![rmbmspool](../images/adminguide/rmbmspool.png)

资源池被删除后即直接销毁，删除前需确保资源池中的物理机未被租户申请和使用，避免影响租户对物理机的管理和使用。

#### 5.2.3.5 修改资源池名称

修改物理机资源池的名称和备注，在任何状态下均可进行操作。可通过点击物理机资源池的列表页面每个资源池名称右侧的“编辑”按钮进行修改；也可通过修改资源池操作进行资源池的名称修改。

#### 5.2.3.6 添加物理机

物理机资源池添加成功后，平台管理员可通过资源池中的物理机管理添加物理机，使平台租户可申请资源池中的物理机进行系统安装及业务部署。为资源池添加物理机的必须准备好以下条件：

* 通过物理机的 IPMI 或 IDRAC 系统查询物理机的整机序列号（SN）、IPMI IP 地址、IPMI 用户名及密码，用于平台对物理机进行初始化和准备工作，以方便后续租户安装操作系统。
* 需提前创建好一个网卡模板，用于添加物理机，也可在添加物理机后修改网卡模板，有关网卡模板的相关管理详见[网卡模板](#_524-网卡模板)章节。

在准备好前提条件后，管理员可进入物理机资源池详情页面，通过指定名称、SN、IPMI IP、IPMI 用户名、IPMI 密码及网卡模板添加一台物理机，如下图所示：

![createbms](../images/adminguide/createbms.png)

* 名称：指物理机在平台的名称标识，添加时必须指定。
* SN：指物理机的硬件整机序列号，添加时必须指定，可通过 IPMI 系统或硬件上进行查看。
* IPMI IP：指物理机的 IPMI IP 地址，添加时必须指定，IP 地址必须从平台可达
* IPMI 用户：物理机的 IPMI 用户名，添加时必须指定。
* IPMI 密码：物理机的 IPMI 密码，添加时必须指定。
* 网卡模板：物理机安装的操作系统使用的网卡配置，如网卡聚合，IP 网段、子接口等，仅用于物理机安装操作系统或重装系统时使用。添加时可不指定，待物理机添加成功后在进行网卡模板的修改和绑定。

管理员确认添加物理机后，平台即会通过 IPMI 触发物理机进行初始化的准备操作，通过 IPMI 远程可查看到物理机已进行开启并引导至 PXE 初始化模块。

* 初始化过程中平台上物理机的状态为【准备中】，待初始化完成后，平台会将物理机进行关机，即代表物理机初始化成功。
* 初始化完成后平台上物理机的的状态为【已就绪】，即代表物理机可被租户申请被进行自动安装操作系统。

物理机在准备中状态时无法进行修改操作，包括修改网卡模板及修改物理机信息，待物理机进入【已就绪】状态时可进入物理机详情页面，查看物理机的硬件配置信息，包括 CPU、内存、磁盘及网卡信息。

#### 5.2.3.7 批量导入物理机

为方便运维人员快捷添加物理机，平台提供批量导入物理机的能力，可根据平台规范上传 CSV 格式的表格文件，批量导入一批物理机，如下图所示：

![importbms](../images/adminguide/importbms.png)

仅支持 CSV 格式且按照平台规范的文件，可参考【物理机列表示例】文件进行表格制作，表格中的信息包括 Name、SN、IPMIIP、IPMIUsername、IPMIPassword 及 NICTemplateID ，分别代表物理机名称、SN 整机序列号、IPMI  IP 地址、IPMI 用户名、IPMI 密码及网卡模板，如下图所示：

![bmcsr](../images/adminguide/bmcsr.png)

批量导入的物理机和手动添加的物理机一致，均会进行初始化准备工作，并将物理机最终置为【已就绪】状态，若物理机一直在准备中，需要登录 IPMI 系统查看物理机的网络及相关配置是否准确。

#### 5.2.3.8 查看物理机

物理机添加至资源池后，管理员可通过资源池详情中的物理机列表查看物理机的相关信息，包括名称、资源 ID、SN、IPMI IP、SMIP User、所属租户、关联网卡模板、状态及操作项，如下图所示：

![bmslist](../images/adminguide/bmslist.png)

* 资源 ID/名称： 为物理机添加至平台后的唯一标识符和名称。
* 所属租户：代表申请该台物理机的租户，未被申请的物理机租户为空。
* 关联网卡模板：物理机添加时指定的网卡模板，物理机安装操作系统时会根据网卡模板配置操作系统的网卡。
* 状态：物理机的状态信息，包括准备中、已就绪、装机中、启动中、关机中、成功及失败。
  * 准备中：指物理机添加后平台对物理机的初始化及准备工作。
  * 已就绪：指物理机已初始化成功，可被租户申请并安装操作系统。
  * 装机中：指物理机正在被租户安装操作系统。
  * 启动中：物理机正在开机中。
  * 关机中：物理机正在关机中。
  * 成功：指物理机已被租户申请并成功安装操作系统。
  * 失败：指物理机安装操作系统失败，可进行重装或由管理员删除物理机。

管理员可通过列表上的操作项对物理机进行移除、修改模板、修改物理机、修改名称和备注等操作，同时支持通过列表对物理机进行批量移除，方便运维操作。管理员也可通过物理机名称进入物理机的详情页面，查看物理机的硬件配置信息，包括 CPU、内存、磁盘及网卡信息，如下图所示共分为基本信息、磁盘信息及网卡信息：

![bmsinfo1](../images/adminguide/bmsinfo1.png)

![bmsinfo2](../images/adminguide/bmsinfo2.png)

**（1）基本信息**

基本信息展示物理机的基本配置及相关信息，包括资源 ID、名称、IPMIIP、配置、申请时间及状态，其中配置信息包括 CPU、内存及总磁盘容量。

**（2）磁盘信息**

磁盘信息展示物理机当前的所有物理磁盘信息，包括磁盘数量、总容量及每一块磁盘的列表信息，其中磁盘列表信息可查看每一块磁盘的名称、容量、厂商、类型及接口协议。

* 磁盘数量和总容量展示当前物理机的总物理磁盘数量和总容量。
* 磁盘的类型指当前磁盘的介质类型，如 HDD 或 SSD 。

**（3）网卡信息**

网卡信息展示物理机当前的所有硬件网卡信息，包括网卡名称、MAC 地址、厂商、型号、硬件地址、最大速率及当前速率。

**由于不同服务器硬件配置及接口类型不同，所对应的网卡名称也会不同（如 eth0、em0、enp61s0f0 等），管理员需要通过网卡信息中的网卡名称进行网卡模板的配置，以确保租户在为物理机安装操作系统时网络配置失败，无法通过网络访问已安装操作系统的物理机。**

#### 5.2.3.9 修改物理机网卡模板

管理员在添加物理机时可指定物理机的网卡模板，用于定义物理机操作系统中网卡的配置信息，如双网卡 bond 、子接口及相关 IP 地址信息。由于不同服务器的网卡名称可能不同可能导致网卡模板的配置不符合现状，可能导致网络配置失败。

为应对灵活配置网卡的应用场景，平台支持管理员修改已添加的物理机网卡模板，以适应物理机的真实网卡配置。仅支持修改状态为【已就绪】及【成功】的物理机网卡模板，具体操作如下图所示：

![upbmsnet](../images/adminguide/upbmsnet.png)

修改物理机的网卡模板不影响运行中的物理机，装机或重装系统时会根据新的网卡模板生效。

#### 5.2.3.10 修改物理机

物理机添加至资源池后，支持管理员修改物理机的基本信息，包括名称、IPMIIP、IPMI 用户名及  IPMI 密码，如下图所示：

![upbms](../images/adminguide/upbms.png)

修改物理机 IPMI 相关信息时，需确保修改的信息准确性，否则可能影响物理机的装机及管理操作。

#### 5.2.3.11 移除物理机

平台支持管理员移除未被租户申请的物理机资源，如下图所示：

![rmbms](../images/adminguide/rmbms.png)

删除物理机后，会自动解绑与网卡模板的关联，且租户无法管理物理机，但不影响物理机本身的正常运行；若物理机已被租户申请且未释放，则无法进行删除。

#### 5.2.3.12 修改物理机名称

修改物理机的名称和备注，在任何状态下均可进行操作。可通过点击物理机列表页面每个物理机名称右侧的“编辑”按钮进行修改；也可通过修改物理机操作进行资源池的名称修改。

### 5.2.4 网卡模板

网卡模板用于定义一批物理机服务器操作系统具体的网卡配置信息，如双网卡聚合及网卡使用的 Vlan 和 CIDR 网段，可在安装操作系统时根据模板自动配置网卡并配置 IP 等信息。

网卡模板用于添加物理机时指定，多个资源池的物理机均可绑定一个网卡模板，即物理机均使用网卡模板上定义的网卡配置参数进行操作系统安装时的网络配置依据。

物理机纳管中的网卡模板可定义网卡的配置，同时可支持网卡聚合（bond）及虚拟网卡（即操作系统中的子接口）配置，其中聚合参数需要指定 bond 网卡名称及需要做 bond 的网卡名称。

网卡名称需要通过物理机的信息进行获取，因此建议在物理机成功添加并进入【已就绪】状态时，通过物理机的网卡信息获取适合物理机的网卡模板；管理员也可自定义多个网卡模板，为不同型号及配置的物理机绑定不同的网卡模板，用于部署和安装操作系统。

#### 5.2.4.1 添加网卡模板

在添加物理机前需要为资源池中的物理机准备一个网卡模板，管理员可通过物理机纳管控制台的网卡模板标签页进行网卡模板的创建操作，如下图所示：

![nictem](../images/adminguide/nictem.png)

创建网卡模板时需指定名称、厂商、型号、网卡设置及虚拟网卡：

* 名称：指网卡模板的名称，用于添加物理机时指定网卡模板的标识。
* 厂商/型号：指网卡模板对应的网卡厂商及型号，添加时可不指定。
* 网卡设置：指服务器操作系统的需要配置的网卡设置，包括基础网卡名称和多网卡聚合。
  * 基础网卡名称：指安装操作系统时需要配置的网卡名称，如 eth0 或 eh1 ；若需要做双网卡 bond ，则需要输入 bond 的网卡名称，如 bond0 或 bond1 。
  * 多网卡聚合：需要做网卡聚合的网卡名称，多个网卡间使用英文的逗号进行分隔；仅在需要做双网卡聚合时指定，如基础网卡为 bond0 所对应的 eth0 和 eth1 ，即代表 eth0 和 eth1 聚合为 bond0 网卡。
* 虚拟网卡：指服务器操作系统中一个网卡对应的子接口，也可为基础网卡。
  * 通常在操作系统中为：interfacename.vlan ，如 eth0.200 工中 bond0.200 。
  * 通过虚拟网卡可以将一个物理网卡拆分为多个虚拟子接口，分别配置不同的 Vlan ，使一个网卡可以同时透传多个 Vlan 的网络数据至交换机。

> 网卡名称可通过已添加的物理机信息进行查看，如 eth0、em0 等。

管理员确认信息无误后，点击确认即在网卡模板列表生成一条网卡模板信息，可通过列表信息查看网卡模板的配置，也可对网卡模板进行修改。

#### 5.2.4.2 查看网卡模板

管理员可通过网卡模板列表查看网卡模板的基本信息，包括名称、资源 ID、厂商、型号及操作项，如下图所示：

![nictemlist](../images/adminguide/nictemlist.png)

可通过列表上的对网卡模板进行修改及删除操作，支持批量删除。

#### 5.2.4.3 修改网卡模板

管理员可随时修改网卡模板的配置信息，与创建模板时一致，可进行修改名称、厂商、型号、网卡设置及虚拟网卡，如下图所示：

![upnictem](../images/adminguide/upnictem.png)

修改网卡模板配置仅对需要安装操作系统或重装系统的物理机生效。

#### 5.2.4.4 删除网卡模板

管理员可通过控制台删除无用的网卡模板，仅支持删除未被使用的网卡模板，即未被物理机关联的网卡模板才可进行删除。

![rmnictem](../images/adminguide/rmnictem.png)

## 5.3 镜像管理

镜像是虚拟机所使用的镜像模板文件，如 CentOS、Windows、Ubuntu 等操作系统模板文件，平台的镜像文件均为 QCOW2 格式。镜像管理是平台为虚拟机提供的镜像仓库，支持基础镜像和自制镜像两种类型：

- 基础镜像是由平台官方默认提供，包括多发行版 Centos 、Ubuntu 及 Windows 等原生操作系统；
- 自制镜像由租户或管理员通过虚拟机自行导出或自定义导入的自有镜像，可用于创建虚拟机，除平台管理员外仅账号自身有权限查看和管理。

### 5.3.1 基础镜像管理

平台默认会提供多发行版 Centos 、Ubuntu 及 Windows 等原生操作系统的基础镜像，基础镜像默认所有租户均可使用。默认提供的镜像包括 Centos 6.5 64 、Centos 7.4 64 、Windows 2008r2 64 、Windows 2012r2 64 、Ubuntu 14.04 64 、Ubuntu 16.04 64。

支持管理将租户自制或导入的镜像复制为基础镜像，作为默认基础镜像共享给平台所有租户使用；同时支持管理员修改基础镜像的名称备注及删除基础镜像。

#### 5.3.1.1 查看基础镜像

在基础镜像列表可查看平台所有基础镜像及镜像信息，包括名称、iD、系统类型、操作系统状态及操作项，如下图所示：

![baseimagelist](../images/adminguide/baseimagelist.png)

- 镜像名称：镜像的标识名称，创建虚拟机时展示在镜像列表中的标识。
- 资源 ID：镜像文件在平台的唯一标识符。
- 系统类型：镜像文件的操作系统类型，包括 Linux、Windows 等。
- 操作系统：镜像文件的 Base 操作系统版本，如 CentOS 6.5 x86_64。
- 状态：基础镜像的状态，包括制作中、可用、删除中。
  - 制作中：指基础镜像正在被制作中，通过自制镜像复制基础镜像时会展示为制作中。
  - 可用：指镜像可被租户使用并可正常创建虚拟机。
  - 删除中：指镜像被删除中。

管理员可通过基础镜像列表对镜像进行删除操作，支持批量删除；同时为方便管理运维，支持搜索基础镜像。

#### 5.3.1.2 删除基础镜像

可以通过删除基础镜像下线平台不需要使用的基础镜像，仅支持删除可用状态的基础镜像，如下图所示：

![rmbaseimage](../images/adminguide/rmbaseimage.png)

**如果平台存在通过此基础镜像创建的虚拟机，则基础镜像无法被删除。**

#### 5.3.1.3 修改名称和备注

修改基础镜像的名称和备注，在任何状态下均可进行操作，可通过点击基础镜像列表页面每个镜像名称右侧的“编辑”按钮进行修改。

### 5.3.2 自制镜像管理

自制镜像由租户或管理员通过虚拟机自行导出或自定义导入的自有镜像，可用于创建虚拟机，除平台管理员外仅账号自身有权限查看和管理。

* 支持管理将为租户导入自定义镜像，并支持管理员将租户的虚拟机导出为自制镜像；同时管理员可下载镜像仓库中的所有自制镜像。

* 支持管理员通过自制镜像创建虚拟机、删除自制镜像、修改自制镜像名称。

为方便平台镜像模板文件的共享，平台支持管理员将一个自制镜像复制为一个基础镜像，使一个租户的自制镜像共享给所有租户使用，适用于运维部门制作模板镜像的场景，如自制镜像操作系统的漏洞修复或升级后，制作一个自制镜像并复制为基础镜像，使所有租户可使用新的镜像文件升级虚拟机系统。

#### 5.3.2.1 查看自制镜像

在自制镜像列表可查看平台所有租户在一个地域内的自制镜像列表信息，包括镜像名称、资源 ID、所属租户、系统类型、操作系统、状态及操作项，如下图所示：

![customeimage](../images/adminguide/customeimage.png)

- 镜像名称：自制镜像的标识名称。

- 资源 ID：自制镜像在平台的唯一标识符。

- 所属租户：自制镜像所归属的租户的主账号的邮箱和 ID。

- 系统类型：自制镜像的操作系统类型，包括 Linux 和 Windows 等。

- 操作系统：自制镜像的 Base 操作系统版本，如 CentOS 6.5 x86_64。

- 状态：自制镜像的状态，包括创建中、可用、删除中、上传中、上传失败。
  - 创建中：指正在通过虚拟机制作自制镜像。
  - 可用：指自制镜像可被租户使用并可正常创建虚拟机。
  - 删除中：自制镜像正在被删除中。
  - 导入中：指自制镜像正在导入中或上传中。
  - 导入失败：指自制镜像导入失败。

管理员可通过自制镜像列表对单个自制镜像进行操作，包括创建虚拟机、复制为基础镜像、下载镜像及删除镜像，支持批量删除；同时支持管理员为某一个租户导入自定义镜像。

#### 5.3.2.2 导入自制镜像

导入镜像是指租户或平台管理员将第三方业务虚拟机以镜像的方式迁移到平台镜像仓库，使租户可以在通过导入的镜像创建并部署业务虚拟机，是用户将业务迁移的重要通道。

支持用户导入 Linux 和 Windows 发行版及自定义镜像，并支持 X86 架构和 aarch64 两种系统架构镜像的导入；云平台的镜像格式默认为 RAW ，用户上传 VHD、VMDK、QCOW2、OVA、ISO 等格式的镜像时，需先将镜像转换为 QCOW2 格式的镜像才可导入，有关转换镜像及自定义镜像的具体操作可参考自制镜像列表上展示的[自定义镜像指南]() 。 

制作好自定义镜像后，可通过镜像管理控制台资源列表上方的【导入镜像】功能，进入导入镜像向导页面：

![upimage](../images/adminguide/upimage.png)

- 租户邮箱：通过租户主账号邮箱选定自制镜像归属的租户。
- 镜像名称/描述：镜像的名称及相关描述信息；
- 镜像地址：平台导入镜像时读取并下载镜像的 URL 地址，导入镜像时必须提供，平台会从提供的 URL 地址自动下载镜像并自动导入至镜像仓库，用于创建虚拟机。
  * 当前仅支持 HTTP、HTTPS 等协议的 URL 地址，格式包括 `https://path/file` 或`ftp://hostname[:port]/path/file` 或 `ftp://user:password@hostname[:port]/path/file` ；
  * 镜像的地址必须从云平台可达，即云平台组件可访问的 URL 地址，建议使用云平台相同外网的 IP 地址或外网 IP 地址可通信的地址。
- 操作系统：导入镜像的操作系统类型，包括 Linux 和 Windows ，需根据导入镜像 OS 类型进行选择；
- 系统架构：导入镜像的系统架构，包括 `x86_64` 和 `aarch64` ，需根据导入镜像进行选择；
- 系统平台：指导入镜像的操作系统平台；
  * Linux 操作系统的系统平台包括 Centos 和 Ubuntu ；
  * Windows 操作系统的系统平台仅支持 Windows ；
- 系统版本：当前需导入镜像的操作系统版本；
  * CentOS x86_64 架构支持  `6.5~6.10` 及 `7.0~7.9` 版本；
  * CentOS aarch64 架构支持 `7.6~7.9` 版本；
  * Ubuntu x86_64 架构支持 14.04 和 16.04 版本；
  * Ubuntu aarch64 架构支持 16.04 和 18.04 版本；
  * Windows  支持 2008、2008R2、2012、2012R2 及 2016 版本；
- 目标镜像大小：当前导入镜像的目标大小，最小 20GB ，最大不能超过 500GB ；
- SHA256 ：用于校验文件完整性的值，默认无需指定。

镜像导入后，自制镜像列表生成一条状态为 “导入中” 的镜像，由于平台需要先下载镜像至镜像仓库且镜像通常较大，导入镜像的时间通常比较长。

镜像状态转换为可用时，即代表镜像导入成功，可进行虚拟机创建、进行镜像下载及复制为基础镜像等操作；若镜像导入过程中出现意外导致失败，则镜像的状态会转换为“导入失败” ，可对失败的镜像进行删除并重新导入镜像。

> 导入镜像前需确保镜像地址可被访问且可读取并下载到镜像。

#### 5.3.2.3 创建虚拟机

管理员可从自制镜像为租户启动一台虚拟机，创建的虚拟机将归属于自制镜像所归属的租户，虚拟机中的程序及数据保持自制镜像的创建时的状态。

使用自制镜像创建虚拟机的过程与基础镜像相同，可根据提示进行操作。从镜像创建虚拟机时设置的管理员密码会覆盖原镜像操作系统中的密码，需使用新密码登录创建的虚拟机。	

#### 5.3.2.4 复制为基础镜像

为方便平台镜像模板文件的共享，平台支持管理员将一个自制镜像复制为一个基础镜像，使一个租户的自制镜像共享给所有租户使用，适用于运维部门制作模板镜像的场景，如自制镜像操作系统的漏洞修复或升级后，制作一个自制镜像并复制为基础镜像，使所有租户可使用新的镜像文件升级虚拟机系统。

若平台需要其它基础镜像系统，可先上传为自制镜像，再通过“复制为基础镜像”的功能转化为平台基础镜像。可通过目标自制镜像右侧“复制为自制镜像”操作，如下图所示：

![cloneimage](../images/adminguide/cloneimage.png)

输入目标基础镜像名称，即可触发复制为基础镜像的操作，自制镜像复制过程中会在基础镜像列表生成一条状态为【制作中】的基础镜像信息，待状态转换为【可用】时，代表复制成功，平台上的所有租户可使用此镜像创建虚拟机，进行业务部署。

#### 5.3.2.5 下载自制镜像

下载镜像指用户将平台自制的镜像下载至本地，用于备份或迁移。虚拟机镜像通过为 GB 级别文件，为保证下载镜像的断点续传等功能，平台以提供下载地址的方式支持镜像下载；可通过 FTP、 SFTP 及相关工具进行镜像下载，以保证断点续传功能，提升镜像下载的成功率。

管理员如果需要下载镜像至本地时，可通过自制镜像列表操作项中的【下载】进入镜像下载向导页面，如下图：

![downloadimage](../images/adminguide/downloadimage.png)

点击生成下载地址后，平台会跳转至下载地址展示向导页面，通过向导页面，用户通过复制下载地址链接，通过 HTTP、FTP 及相关下载工具下载镜像。

![downloadimage1](../images/adminguide/downloadimage1.png)

> 镜像下载地址有效期为 24 小时，需在 24 小时内进行镜像下载。若镜像下载地址过期，则无法进行下载，需到平台重新生成镜像下载地址。

#### 5.3.2.6 删除自制镜像

管理员可对自制镜像进行删除操作，被删除的自制镜像会自动进入所属租户的“**回收站**”，可通过回收站进行还原和销毁操作。管理员可通过自制镜像管理控制台的“删除”功能进行自制镜像的删除，删除后可到回收站中查看已删除的自制镜像，如下图所示：

![rmimage](../images/adminguide/../UserGuide/rmimage.png)

仅支持删除状态为可用或导入失败的的自制镜像；若已通过自制镜像创建虚拟机，则不可删除自制镜像，需要将虚拟机删除，才可进行自制镜像的删除。

#### 5.3.2.7 修改名称和备注

修改自制镜像的名称和备注，在任何状态下均可进行操作。可通过点击自制镜像列表页面每个镜像名称右侧的“编辑”按钮进行修改。

## 5.4 外网网段管理

外网网段是平台对外通信的网络，一般由管理员或运维人员通过物理网络分配并配置至云平台。外网网段是平台为租户分配外网 IP （弹性 EIP）的 IP 资源池，支持 IPv4 和 IPv6 两种 IP 类型，并支持配置网段路由并自动下发路由至平台虚拟机。

平台在部署时默认为配置一段外网网段，如果平台业务需求，也可由管理员在管理控制台上自助添加 IP 网段，在添加 IP 网段前需要保证物理交换机上已为节点外网网络配置 Vlan 及相关网段信息。

网段管理仅作为平台管理员将物理网络上的网段信息录入至云平台，使云平台的租户可申请外网网段是的 IP 地址作为虚拟资源的外网 IP ，与平台外网进行通信。

支持管理员对外网 IP 的网段进行维护及管理，包括 IP 网段、网关、外网网卡、VLAN、路由及网段权限等配置，方便云平台管理员对外网 IP 地址池的管理，同时支持 IPv4 和 IPv6 双栈 IP 资源池管理。

* 支持通过私有 IP 地址段模拟外网网段，在交换机或上层路由将私有 IP 地址段 NAT 到互联网。
* 支持为每个网段配置路由策略，即租户申请网段的外网 IP 绑定至虚拟资源后，下发目的路由地址的流量自动以绑定的外网 IP 为网络出口。路由策略提供默认路由、指定路由及暂不指定三种模式：
  - 默认路由：即下发路由的目的地址为 0.0.0.0/0 ，代表默认所有流量均以绑定的外网 IP 为出口。
  - 指定路由：即管理员指定目的地址（如 10.0.2.0/24 ）的流量以绑定的外网 IP 为出口。
  - 暂不指定：即该网段不自动下发路由，仅可通过此外网 IP 地址与本网段进行通信。
* 支持管理员为云平台添加 IPv4 或 IPv4 版本的网段，使平台租户可同时申请 IPv4 和 IPv6 版本的外网 IP ，并绑定至虚拟机提供网络服务。
* 支持管理对每个网段的开放范围进行控制及修改，默认为所有租户（所有租户可申请并使用网段 IP），支持配置为部分租户（指定的租户才可申请并使用网段 IP，未指定租户无法查看并申请网段 IP）

为方便管理员和运维人员，平台提供外网网段的创建、查看、修改及删除等生命周期管理。外网网段中 IP 地址的带宽规格可参考全局配置中的【规格配置】

> 外网网段管理与平台部署的物理网络及架构拓扑紧密相关，在维护外网网段前需确保物理网络配置完善后，至平台录入 IP 网段后才可使用。

### 5.4.1 创建外网网段

管理员在物理网络设备配置好 Vlan 及网段信息后，通过平台资源管理进入外网网段资源控制台，指定网段名称、描述、IP 版本、网段、网关、网卡、Vlan、路由及租户权限创建一个外网网段，如下图所示：

![createnet](../images/adminguide/createnet.png)

* 名称/描述：指外网网段的名称和描述，名称会作为租户端申请外网 IP 时展示的网段名称。
* IP 版本：指外网网段的 IP 版本，支持 IPv4 或 IPv6 ，创建时必须指定，默认为 IPv4。
* 网段：指外网网段的 CIDR 网段，创建时必须指定。若版本为 IPv4 ，则必须输入 IPv4 版本的网段，如 192.168.1.0/24 ；若版本为 IPv6 ，则必须输入 IPv6 版本的网段。
* 网关：指外网网段的网关地址，创建时必须指定，网关必须在网段的范围内且与物理网络上配置一致，否则会影响网络通信。
* 网卡：指外网网段在物理节点上对应的网卡名称，即物理网络设备上网段与平台计算节点外网相连的网卡，如 bond0  或 eth0。
* Vlan：指外网网段在物理网络设备中配置的 Vlan 信息，平台在通信时会带上 Vlan 信息透传至物理网络，若无 Vlan 可不配置。
* 路由：为网段配置路由策略，即租户申请网段的外网 IP 绑定至虚拟资源后，下发目的路由地址的流量自动以绑定的外网 IP 为网络出口。路由策略提供默认路由、指定路由及暂不指定三种模式，默认值为默认路由。
  - 默认路由：即下发路由的目的地址为 0.0.0.0/0 ，代表默认所有流量均以绑定的外网 IP 为出口。
  - 指定路由：即管理员指定目的地址（如 10.0.2.0/24 ）的流量以绑定的外网 IP 为出口，支持多条指定路由策略。
  - 暂不指定：即该网段不自动下发路由，仅可通过此外网 IP 地址与本网段进行通信。
* 租户权限：管理对每个网段的开放范围进行控制，支持所有租户和指定租户，默认为所有租户。
  * 所有租户指平台上所有租户可申请并使用网段的 IP 地址。
  * 部分租户是指指定的租户才可申请并使用网段 IP，未指定租户无法查看并申请网段 IP。

创建网段后，外网网段列表会生成一条可用状态的网段信息，代表网段已可被申请和使用。

### 5.4.2 查看外网网段

管理员可通过外网网段控制台的列表查看已创建的外网网段的列表信息，包括网段 ID、名称、IP 版本、网段、网关、网卡、Vlan、租户权限、状态及更新时间。

租户权限中或指定所有租户展示为【所有租户】，若指定的为部分租户，则展示有权限的租户邮箱地址信息。

### 5.4.3 修改租户权限

当需要将一段外网网段独享给部分租户时，管理员可修改外网网段的租户权限，如下图所示：

![upnetauth](../images/adminguide/upnetauth.png)

修改租户权限后，无权限的租户即无法查看并使用外网网段的 IP 地址，但不影响已申请外网 IP 地址的使用，若租户释放了外网 IP ，则无法在申请该网段的  IP 地址。

### 5.4.4 删除外网网段

 支持管理员删除不再使用的外网网段，如下图所示：

![rmnet](../images/adminguide/rmnet.png)

若网段中的 IP 地址已被租户申请，则无法删除，需要租户将所有的外网 IP 地址释放后，才可进行删除；管理员也可通过虚拟资源管理中为租户释放外网 IP 地址。

# 6 虚拟资源管理

平台为管理员提供全平台所有租户的虚拟资源全生命周期运营和管理能力，使平台管理员可通过控制台统一管控平台的整体虚拟资源，包括租户端的所有产品服务，如虚拟机、虚拟机模板、弹性网卡、VPC 网络、外网 IP、安全组、负载均衡、NAT 网关、云硬盘及快照等资源，同时对于云硬盘资源还支持单盘 QoS 控制，用于控制单块云硬盘的读写 IOPS 及读写带宽。

## 6.1 虚拟机管理

平台支持管理员指定租户创建 Windows、Redhat、Ubuntu、CentOS 操作系统的虚拟机，创建的虚拟机归属于指定的租户所有。

同时支持管理员对平台所有租户的虚拟机进行全生命周期管理，如查看虚拟机详情信息、VNC登录、启动/重启/关机/断电、密码重置、系统盘扩容、制作镜像、重装系统、绑定外网IP、解绑外网IP、设置默认出口、修改内/外网安全组、修改虚拟机配置、执升级、修改名称和备注、修改告警模板及删除销毁虚拟机。

## 6.2 虚拟机模版

平台支持管理员指定租户创建虚拟机模板，创建的虚拟机模板归属于指定的租户所有；同时支持管理员对平台所有租户的虚拟机模板进行全生命周期管理，如查看、创建虚拟机、删除等。

## 6.3 弹性网卡管理

支持管理员指定租户创建弹性网卡，创建的弹性网卡归属于指定租户所有，仅可绑定至租户的虚拟机，并支持管理员对平台所有租户的弹性网卡进行全生命周期管理，如查看、绑定、解绑、删除等。

## 6.4 VPC 网络管理

支持管理员指定租户创建 VPC 网络和子网，创建的 VPC 和子网归属于指定租户所有，创建虚拟资源时仅可选择租户拥有的 VPC 和子网资源；同时支持管理员对平台所有租户的VPC网络和子网进行全生命周期管理，如查看、删除、创建子网、删除子网等。

## 6.5 外网 IP 管理

支持管理员指定租户申请指定 IP 网段的外网 IP 地址，申请的 IP 地址归指定租户所有，仅支持申请指定租户有权限的网段进行 IP 地址申请；同时支持管理员对平台所有租户的外网 IP 地址进行管理，如查看、绑定、解绑、修改带宽、删除等，仅支持绑定给与外网 IP 地址相同租户的虚拟资源。

## 6.6 安全组管理

支持管理员指定租户创建安全组，创建的安全组归指定租户所有，仅支持绑定给与安全组相同租户的虚拟资源；同时支持管理员对平台所有租户的安全组进行全生命周期管理，如安全组规则的变更和管理。

## 6.7 负载均衡管理

支持管理员指定租户为租户创建负载均衡实例，实例归属指定租户所有，仅支持添加指定租户有权限的虚拟机资源到服务节点；同时支持管理员对平台所有负载均衡进行管理，如  VServer 、服务节点、域名转发策略及 SSL 证书管理等。

## 6.8 NAT 网关管理

支持管理员指定租户为租户创建 NAT 网关实例，实例归属指定租户所有，仅支持添加指定租户有权限的虚拟资源到 SNAT 和 DNAT 规则；同时支持管理员对平台所有 NAT 网关进行管理，如所有 NAT 网关的 SNAT 及 DNAT 规则管理。

## 6.9 硬盘管理

### 6.9.1 租户云硬盘管理

支持管理员指定租户创建云硬盘，创建的云硬盘归指定租户所有，仅支持申请指定租户有权限的集群类型进行云硬盘创建；同时支持管理员对平台所有租户的云硬盘资源进行全生命周期管理，如查看、绑定、解绑、扩容、快照、删除等，删除的云硬盘会进入租户的回收站，仅支持绑定与云硬盘相同租户的虚拟机，同时制作的快照归租户所有。

### 6.9.2 云硬盘 QoS

平台全局默认提供全局云硬盘 QoS 配置，即新创建的云盘会根据平台公式赋予 QoS 值，限制平台用户对磁盘性能强行占用。同时平台支持管理员对平台所有租户的云硬盘自定义设置 QoS 值，仅当全局 QoS 配置开启时，管理员为每个云硬盘自定义的  QoS  才可生效。

每一块云硬盘创建出来后，管理员可在存储资源——硬盘列表上进行“QoS配置” ，同时可对虚拟机详情磁盘中的系统盘进行 QoS 配置，如下图所示可设置的 QoS 项包括：

![volumeqos](../images/adminguide/volumeqos.png)

* 读/写 IOPS

  当磁盘的 Arch 架构为 HDD 时，可设置的读/写 IOPS 范围为 `0~50000` ，默认值为1000，配置为 0 不限速。

  当磁盘的 Arch 架构为 SDD 时，可设置的读/写 IOPS 范围为 `0~50000` ，默认值为计算公式根据当前硬盘容量计算的值，配置为 0 不限速。

- 读写带宽（MBps）

  当磁盘的 Arch 架构为 HDD 时，可设置的读/写带宽范围为 `0~1000Mbps` ，默认为100，配置为0则不限速。

  当磁盘的 Arch 架构为 SSD 时，可设置的读/写带宽范围为 `0~1000Mbps` ，默认为计算公式根据前当前硬盘容量计算的值，配置为0则不限速。

硬盘扩容容量后，会根据计算公式重新计算新容量的 QoS 值，根据计算的QoS值重新设置硬盘的 QoS。

- 若硬盘扩容前设置的 QoS 值  < 新容量 QoS 值，则以新容量 QoS 值为准。
- 若硬盘扩容前设置的 QoS 值 > 新容量 QoS 值，则以扩容前设置的值为准。

> 硬件介质和容量会影响硬盘的读写 IOPS 和宽带速率，若配置的 QOS 超过硬件本身性能，以硬件性能为准。系统会默认分配 QOS 值，如需取消一块硬盘的限速功能，可将 IOPS 和宽带均配置为 0。

## 6.10 快照管理

支持管理员查看并管理平台所有租户的云硬盘快照资源，如回滚和删除，仅支持将快照数据回滚至原始云硬盘。

## 6.11 外置存储管理

支持管理员查看并管理平台上已分配给租户的所有外置存储 LUN 存储卷信息，同时支持管理员对存储卷 LUN 设备进行绑定和解绑操作，仅支持绑定 LUN 设备到所属租户的虚拟机实例，为所属租户的虚拟机提供数据盘服务。

管理员在帮租户创建虚拟机时，也可选择有权限的外置存储 LUN 设备作为虚拟机的系统盘。

# 7 租户管理

## 7.1 概述

租户主要为企业用户提供组织架构管理，以及基于租户实现资源访问控制、审批流程、费用管理等功能。

**组织架构**

![organazation](../images/adminguide/organazation.png)

**概念解释**

* **租户**

  平台支持多租户模式，用于有多级组织架构的企业，可将租户作为一个单独的公司/子公司/部门进行运营，有效实现权限管理，除低总公司、子公司及不同部门资源混用可能造成的风险，并可实现资源审计。

  租户是平台中一组资源的集合，提供资源隔离、子账号、权限控制、配额及价格配置等能力。不同租户间资源通过 VPC 网络及权限实现强隔离；租户内所有主账号和子账号的资源、费用、配额及审批均归属于租户

- **账号**
  
  - **主账号**：一个租户默认有一个主账号，主账号即为租户下的初始管理人员，默认有租户下所有资源的管理权限以及组织管理权限。主账号可通过创建子账号，并管理子账号的权限。
  - **子账号**：子账号是主账号创建的用户，子账号在租户下的权限由主账号控制。一个租户可拥有多个子账号，支持对子账号进行资源管理的权限控制。
  
- **人员**：企业中的人员，人员需要使用账号登录云平台使用资源

- **角色**：权限的集合，为用户和成员组赋予权限可获得调用相关API进行资源操作的能力。

- **项目组**：以项目组为维度进行资源规划，可为一个具体项目或者业务建立独立的资源池，实现资源更细粒度地管理。同时针对子账号的授权，也是基于项目组的维度。

- **流程审批**：为了满足企业对核心云资源，如虚拟机、云硬盘、外网IP等资源使用的管控需求所引入的云资源工单审批流程。

- **审批管理**：审批管理目前仅平台管理员admin可以进行操作。

  

## 7.2 创建租户

管理员可通过创建账户来新增平台的租户，创建租户同时会新增一个主账号。如下图所示，创建账户时需要输入账户名称、账户邮箱、账户密码、确认密码、是否资源审批、是自自动审批等：

![addacc](../images/adminguide/addacc.png)

- 账户名称：租户和主账户的名称标识。

- 账户邮箱：主账户的邮箱。
- 账户密码：主账户的登录密码
- 确认密码；再次确认主账号的登录密码
- 资源审批：是否需要为租户开启资源审批，为账户所在租户开启资源审批流程，此租户下用户创建云主机、云硬盘、私有网络、外网IP，修改云主机配置、扩容系统盘、扩容数据盘、调整带宽需要走申请流程。平台默认审批流程是由平台管理员对资源申请进行审批。
- 自动审批：是否需要为租户开启资源的自动审批，开启自动审批后，租户的主/子账号提供资源申请后，将自动进行审批，无需人工干预即可完成资源的审批和创建。

创建后，将账号的邮箱和密码发送给最终用户，用户即可使用此账户登录云平台进行相关资源操作。

> 账户创建后余额默认为0，需要进入账户的充值管理页面，为账户充值后，用户才可正常创建和使用资源。

## 7.3 查看租户列表

管理员可查看平台所有的租户列表，一个账户代表一个租户。在创建账号时，平台默认会创建一个租户和一个主账号，主账号即为此租户的管理者。账户的列表信息如下图所示：

![acclist](../images/adminguide/acclist.png)

- 账户 ID：租户的 ID 。
- 账户名称：账户的名称。
- 账户邮箱：租户下主账号的邮箱地址。
- 现金余额：租户的现金余额。
- 赠送余额：租户的赠送余额。
- 信用余额：租户的信用余额。
- 状态：租户的状态信息，包括未激活、使用中、冻结中等。
  - 未激活：指用户通过平台注册账号时，未通过邮箱激活链接进行账号激活，可通过管理员在租户列表上进行激活操作。
  - 使用中：指租户的状态为使用中。
  - 冻结中：指租户已被冻结，租户下的主账号和子账号均不可进行登录和使用。
- 审批流程：租户是否设置了审批流程，包括开启和关闭。
- 自动审批：租户是否开启了自动审批，包括开启和关闭。
- 创建时间：租户的创建时间。

管理员可通过租户列表对每个租户进行管理和操作，包括冻结、解冻、登录限制及编辑审批流程，同时可通过详情按钮进入租户的详情，对租户的账号及配置进行全局管理，同时支持修改租户的账户名称，如下图所示：

![upaccname](../images/adminguide/upaccname.png)

账户概览页面主要展示账户的基本信息和账户下所有的成员，其中基本信息包括账户 ID、账户名称、账户邮箱、现金余额、赠送余额、信用余额、创建时间，有关租户成员管理详见[租户成员管理]()。

## 7.4 冻结租户

冻结账户是指将一个租户进行锁定，被成功冻结的租户，主/ 子账号将无法登录云平台，不影响租户内已创建资源的及业务的正常运行。仅支持状态为【使用中】的租户进行冻结操作，管理员可通过租户列表的冻结进入冻结租户的向导页面，如下图所示：

![lockacc](../images/adminguide/lockacc.png)

租户被冻结后，租户内的主子账号均会被冻结，即所有的账号均无法使用，需要对租户进行解冻，租户内的所有账号才可使用。

## 7.5 解冻租户

当租户被冻结后，租户的状态为冻结中，支持管理员通过租户管理解冻一个租户，如下图所示：

![unlockacc](../images/adminguide/unlockacc.png)

租户解冻后，默认租户中的所有账号均会被解冻，并可正常登录控制台。若冻结租户前，有子账号为冻结中，解冻租户后，之前被冻结的子账号依然保持为冻结中，需要到租户中单独解冻被冻结的子账号，适用于有子账号离职，冻结其账号的场景。

## 7.6 登录限制

管理员可为租户设置登录限制策略，登录访问策略决定可以登录控制台和访问 API 的客户端 IP 地址，配置后账号只能从指定的 IP 登录或发起 API 访问，默认不指定任何 IP，代表不限制登录控制台和访问 API 的 IP 地址。

管理员为租户设置登录限制的场景举例：主账号设置的登录 IP 地址错误导致租户下所有账号均无法登录，可联系平台管理员通过管理控制台侧修改租户的登录访问限制。

管理员可通过租户列表操作项中的“登录访问限制”功能对租户的登录策略进行配置，如下图所示，默认为空代表全网无限制。

![LoginWhitelist](../images/adminguide/LoginWhitelist.png)

## 7.7 编辑审批流程

管理员可通过编辑审批流程管理租户下的审批流程设置，以开启或关闭一个租户下所有账号变更资源的审批流程方式，包括开启/关闭资源审批及开启/关闭自动审批。

![editapprove](../images/adminguide/editapprove.png)

## 7.8 租户成员管理

租户成员管理支持查看并管理租户下已有主账号和子账号，包括查看账号信息、修改密码、冻结账号及解冻账号。

### 7.8.1 查看账号信息

成员列表主要展示租户下的主账号和子账号信息，包括角色 ID、角色、账户 ID、账户名称、邮箱 、状态、创建时间及操作项，同时支持对主子账号进行搜索操作。管理员可通过租户列表中租户的 ID 进入租户详情的概览页面，查看成员的列表信息，如下图所示：

![acclist1](../images/adminguide/acclist1.png)

- 角色 ID：主账号/子账号在平台的唯一标识符。
- 角色：账户的角色，分为主账号和子账号两种。
- 账户ID：账号的唯一标识符。
- 账户名称：账户的名称。
- 邮箱：账户的登录邮箱
- 状态：账户的状态，包括冻结中、使用中。
- 创建时间：账户的创建时间。

### 7.8.2 修改密码

支持管理员修改一个租户内所有的主子账号密码，以适应主子账号忘记密码的场景。

### 7.8.3 冻结账号

支持管理员单独冻结一个租户内的主账号或子账号。冻结成功的主账号，将不允许登录控制台，不影响其它子账号；冻结成功的子账号，将不允许登录控制台，不影响其它子账号及主账号。

![lockmasteracc](../images/adminguide/lockmasteracc.png)

* 若账号被冻结时，管理员将账号所属租户冻结，则账号为冻结中状态。
* 管理员将租户解冻时，不影响以前就冻结的账号，即租户解冻，该账号依然为冻结中。
* 需要单独对账号进行解冻操作，才可正常登录并使用控制台。

### 7.8.4 解冻账号

支持管理员单独解冻一个租户内的主账号或子账号，解冻成功的将允许登录控制台。如一个账号因多次输入密码错误导致账号被冻结，可通过租户成员管理单独解冻账号。

![unlockmasteracc](../images/adminguide/unlockmasteracc.png)

## 7.9 租户订单管理

通过租户管理，管理员可查看所属租户的订单管理，同时可通过自定义查询时间查看租户在一定时间周期内产生的订单，并支持管理员下载订单管理信息为本地 Excel 文件，如下图所示：

![accorder](../images/adminguide/accorder.png)

## 7.10 租户交易管理

通过租户管理，管理员可查看所属租户的交易信息，同时可通过自定义查询时间查看租户在一定时间周期内产生的交易记录，并支持管理员下载交易管理信息为本地 Excel 文件，如下图所示：

![acctran](../images/adminguide/acctran.png)

## 7.11 租户充值管理

通过租户管理，管理员可为租户进行账户余客充值，同时可查看所属租户的充值记录信息，可通过自定义查询时间查看租户在一定时间周期内产生的充值记录。

### 7.11.1 账号充值

管理员可通过租户详情页面进入租户充值管理标签页面为租户进行充值，充值方式分为账户余额和免费余额两种，管理员可按照使用需求，为租户充值：

* 账户余额的充值涞源分为微信支付、银行转账、支付宝支付、微信支付、新浪支付五种。
* 免费余额为平台为用户赠送的余额，用于测试。

![recharge](../images/adminguide/recharge.png)

单次充值最小金额为 100 ，最大为 500000 。

### 7.11.2 查询充值信息

管理员通过充值管理，查看一定时间段内的充值记录信息，包括充值单号、充值渠道、充值方式、充值金额及充值时间等，并支持管理员下载充值记录信息为本地 Excel 文件，如下图所示：

![rechargelist](../images/adminguide/rechargelist.png)

## 7.12 管理租户配额

### 7.12.1 查看租户配额

通过租户管理，管理员可查询当前租户对平台资源的配额设置，同时支持管理员修改租户下每个产品的配额信息，包括产品类型、地域、配额值、更新时间及操作项。

![accquota](../images/adminguide/accquota.png)

通过操作项，管理员可针对每个产品修改在地域中的配额值。

### 7.12.2 修改租户配额

平台支持配置租户配额的产品包括虚拟机、镜像、VPC、硬盘、网卡、外网 IP、负载均衡、安全组、NAT 网关及 VPN 网关，可根据每个产品针对每个地域及全部地域进行配额配置。

![upaccquota](../images/adminguide/upaccquota.png)

租户的配额默认继承平台全局的配额设置，管理员可自定义每个租户的产品配额 ；同时针对每个产品的配额之和不可超过全部地域的配额限制。

## 7.13 管理租户价格

### 7.13.1 查看租户价格

通过租户管理，管理员可查询当前租户在平台上计费资源的价格信息，包括产品、地域、集群、计费类型、计费规则、价格、折扣、折扣价格、更新时间及操作项。

![setaccprice](../images/adminguide/setaccprice.png)

通过操作项，管理员可针对每个产品修改在地域及不同集群的价格，计费资源包括 CPU、内存、硬盘、内网带宽、GPU，及租户创建虚拟资源时，通过计费资源的费用合计按照付费方式进行扣费。

* 针对 CPU、内存、GPU 等计算计费资源在不同的计算集群可定义并展示不同的价格及折扣。
* 针对硬盘在不同的存储集群可定义并展示不同的价格和折扣。
* 针对内网带宽可展示并定义全局的价格和折扣。
* 针对不同的外网网段可展示并定义不同的价格和折扣。

列表上的价格为平台全局【价格配置】中设置的全局价格，管理员可通过租户价格列表查看每种资源在不同集群的基准价格，同时可通过折扣价格查看资源设置折扣后的折扣率及最终价格。

### 7.13.2 设置租户折扣

租户在平台的资源价格默认继承平台全局的价格配置，管理员可自定义每个租户的产品价格折扣，设置单个资源在针对租户在不同集群的价格，如下图以修改 CPU 在集群 `ComputeSetAAAA` 的按月付费折扣为例：

![UpdateDiscount](../images/adminguide/UpdateDiscount.png)

其中折扣为百分数，如 90 为基准价格的 9 折，即将租户 CPU 按月付费的价格打 9 折。修改后即会生效，租户已创建的资源不受影响，新创建的 CPU 资源将按照新的价格进行扣费。

修改租户的产品折扣只对本租户生效，不影响其它租户的价格，满足针对不同客户类型提供不同云资源价格的场景，提升运营效率。

## 7.14 账户资源概览

通过租户管理，管理员可查看所属租户的资源概览信息，包括资源使用率及资源配额使用情况，如下图所示：

![accoverview](../images/adminguide/accoverview.png)

* 资源使用率：指租户在平台中的所有资源的平均使用率，包括 CPU 平均使用率、内存平均使用率、硬盘平均使用率及带宽平均使用率。
* 资源配额使用情况：指租户在平台中所有资源的配额占用情况，包括虚拟机、镜像、硬盘、弹性网卡、VPC、外网弹性 IP、安全组、负载均衡、NAT 网关、VPN 网关、MySQL 及 Redis 的总配额以及已使用的配额情况。

## 7.15 删除租户

支持删除租户，租户被删除后，租户下的所有账号将被同步清除，无法再使用这些账号登录平台。

> 注意，删除租户的前提是，租户下的资源已被清除。建议在删除租户前，和租户相关管理人员沟通，确认不需要再使用云平台后，及时清理资源。如果租户不自主清理资源，可在管理后台，各个资源列表处，搜索到此租户的资源后进行删除。虚拟机、云硬盘、外网IP删除后会进入回收站，需要在回收站中彻底销毁以释放资源。

# 8 审批管理

## 8.1 概述

### 8.1.1 产品简介

随着信息化数字转型在政企、教育、金融、制造等行业的实践和应用，企业对资源管理的标准化、流程化管理需求日益旺盛，对于云化资源同样需要设置标准的审批流程，满足平台资源的申请、审批的业务使用流程的需求。

针对企业云化资源的管理，云平台为为企业管理者提供的自助模式的资源审批服务，用于制定信息系统云化资源的标准使用流程，在租户或子账号需要使用或管理资源时，按照流程中定义的审批人和审批层级完成审批后，由平台自动化交付用户需要业务资源。

平台审批流程由平台管理员进行定义和发布，并由平台管理者设置是否为一个租户设置开通审批流程，支持手动审批和自动审批。

* 手动审批：租户下主账号和子账号进行虚拟资源操作时需要走申请、审批流程，待审批通过后，平台会自动为用户创建或操作所需资源，并生一条审批记录用于追溯。
* 自动审批：租户下主账和子账号进行虚拟资源操作无需人工介入，系统将自动审批通过，并自动生成一条审批记录用于保留相关申请记录和审批记录。

开通资源审批的前提是设置审批流程，用于定义租户申请资源时，需要多少层级的审批，每一层级由谁进行审批，所有层级均通过后才可进行资源的创建和变更操作。为满足企业多种场景的审批业务，平台内置默认审批流程。

默认审批流程提供简单的审批逻辑，仅支持 1 级审批，当平台管理者为租户开启资源审批流程后，租户及子账号下资源的创建及变更申请统一由【平台管理员】进行审批，即平台管理员审批通过后，平台将自动执行资源的变更操作。

审批流程支持多种资源的变更操作，包括虚拟机、云硬盘、VPC 网络、外网 IP 及负载均衡 ，支持的变更如下：

* 虚拟机：创建虚拟机、修改配置、扩容系统盘、扩容数据盘；
* 云硬盘：创建云硬盘、扩容磁盘；
* VPC 网络：创建 VPC ；
* 外网 IP：创建外网 IP、调整带宽；
* 负载均衡：创建负载均衡。

### 8.1.2 审批使用流程

**（1）管理员为租户开启审批流程**

管理员通过租户列表为租户开启审批流程，同时可开自动审批。开启后租户在创建虚拟机时即需要发起审批流程，待管理员进行审批后，平台会自动发起虚拟机的创建操作。

**（2）租户申请变更资源**

由租户在租户控制台发起资源变更操作（本文以申请虚拟机为示例）：

1. 进入虚拟机控制台，通过【创建虚拟机】进入虚拟机创建引导页面；

2. 填写申请名称和申请备注，按照虚拟机的创建要求输入其它必填信息，点击【立即购买】提交申请。

3. 提交申请后，页面会自动跳转至【申请管理】页面，并在申请列表中自动新增一条待审批的申请记录。

**（3）管理员审批**

由平台管理员 admin 账号通过【审批管理】中的待办对租户的申请进行通过或拒绝的审批，完成审批流程。

* 若平台管理员通过申请，则租户的申请状态变更为【已申请】，并会自动执行虚拟机的创建操作，可通过虚拟机列表查看正在创建的虚拟机资源，待资源创建成功后，申请状态变更为【成功】。
* 若平台管理员拒绝申请，则租户的申请状态变更为【已拒绝】，申请的资源变更将不被执行，可联系平台管理员或查看审批备注了解拒绝原因。

审批结束后，管理员可通过审批管理中的已办审批列表查看平台上所有的审批记录及资源详细信息，方便后续针对平台和业务进行审计。

## 8.2 为租户开启审批

平台支持管理员创建租户时为租户开启审批流程，同时支持为已创建的租户开启或关闭审批流程，方便平台的管理和运营。

### 8.2.1 创建租户开启审批

管理员新建租户时，支持为租户开启/关闭审批流程，并支持设置开启/关闭自动审批，如下图所示：

![approval](../images/adminguide/approval.png)

- 资源审批：是否需要为租户开启资源审批，为账户所在租户开启资源审批流程，此租户下用户创建云主机、云硬盘、私有网络、外网IP，修改云主机配置、扩容系统盘、扩容数据盘、调整带宽需要走申请流程。平台默认审批流程是由平台管理员对资源申请进行审批。
- 自动审批：是否需要为租户开启资源的自动审批，开启自动审批后，租户的主/子账号提供资源申请后，将自动进行审批，无需人工干预即可完成资源的审批和创建。

### 8.2.2 已创建租户审批流程

平台支持管理员为已创建的租户开启或关闭审批流程，同时支持开启或关闭自动审批。可通过租户管理页面租户列表的【编辑审批流程】对已创建租户的审批流程进行变更，同时可查看当前租户的审批流程开关状态，如图所示：

![editapprove](../images/adminguide/editapprove.png)

## 8.3 审批管理

审批管理为平台管理员提供整个云平台所有的审批流程记录，包括待办和已办两个部分。

* 待办：指租户发起资源变更申请后，需要管理员进行审批的记录。
* 已办：指管理员已经处理过的审批记录，包括通过和拒绝的所有记录。

### 8.3.1 查看审批记录

平台管理可在审批管理列表查看平台所有待办和已办审批记录，已办列表主要展示已由平台管理员审批过的申请记录；代办列表展示尚未被审批的申请记录。

管理员可通过导航栏【审批管理】进入审批管理控制台，通过审批记录的待办和已办列表查看所有的审批记录信息，如下分别为待办和已办的列表：

![approvewait](../images/adminguide/approvewait.png)

![approvedone](../images/adminguide/approvedone.png)

通过待办和已办列表信息，管理员可分别查看需要处理及已处理的审批记录的列表信息，包括申请名称、资源类型、操作、账号邮箱、账号 ID、创建时间、审批结果及操作项。

- 申请名称：用户提交的申请名称。
- 资源类型：本次申请涉及到的资源类型。
- 操作：本次申请针对资源进行对操作。
- 账号邮箱：申请人的账户邮箱。
- 账户 ID：申请人的账户 ID。
- 创建时间：申请的创建时间。
- 审批结果：已办审批列表可查看审批结果，分为通过和拒绝两种情况。

待办列表的操作项中支持管理员对审批记录进行通过和拒绝操作，同时为方便平台运营支持管理员下载审批管理的待办及已办信息为本地 Excel 文件。

管理员也可通过详情按钮进入审批记录的详请页面，查看本条审批记录对应的申请详情，包括申请的基本信息、资源信息、关联资源以及处理记录，如下图所示：

![approveinfo](../images/adminguide/approveinfo.png)

（1）申请信息：描述本次申请的详细信息，如申请名称、申请资源类型、申请的变更操作及申请的状态及时间。

（2）关联资源：描述本次申请的关联资源信息。**管理员审批通过的申请记录会存在关联资源，被拒绝的申请将不执行资源操作，不会产生关联资源信息。**

（3）资源信息：代表本次申请时提交的资源变更具体配置信息，如申请创建虚拟机时的规格、VPC 网络、镜像等，同时包括资源的申请时的计费信息。

（4）处理记录：当前申请记录的处理记录，并可查看所有处理节点的流程节点、处理人、备注及处理时间。

* 流程节点：指当前申请记录所使用的审批流程的所有节点，如平台默认的审批流程包括提交申请、默认审核节点、资源操作等。
* 处理人：指每一个流程节点的处理人，如提交申请人的邮件地址为 claire.kan@ucloud.cn，默认审核节点的处理人为 admin@ucloud.cn 。
* 备注：指每一流程节点的备注，如平台管理员通过或拒绝申请时给予的说明。
* 处理时间：指每一个流程节点人的处理时间。

### 8.3.2 通过申请

租户发起资源变更申请后，管理员审批管理的待办列表中会生成一条审批记录，支持管理员对租户的申请进行通过操作，即同意用户的资源变更申请。审批通过后将自动为申请租户执行资源操作，下发资源或对资源执行变更。

![approvepass](../images/adminguide/approvepass.png)

### 8.3.3 拒绝申请

租户发起资源变更申请后，管理员审批管理的待办列表中会生成一条审批记录，支持管理员对租户的申请进行拒绝操作，即拒绝用户的资源变更申请。审批拒绝后申请将直接结束流程，不再执行资源操作。

![approverefuse](../images/adminguide/approverefuse.png)

# 9 账务管理

## 9.1 概述

计费管理为用户资源分配和使用提供计量计费服务，需计费的资源均支持按时、按年、按月三种计费方式，支持资源的计费、扣费、续费、过期回收及退费等订单管理操作，同时基于基于账户提供充值、扣费、退费等交易管理。子账号共享主账号的账户余额，通过子账号创建的资源可直接通过共享余额进行扣费，并可通过主账号或子账号查看账户的交易流水及订单明细。

平台资源计费均为预付费模式，即无论按时、按年、按月付费，在资源创建时都需保证账户余额可满足一个计费周期的扣费，下一个计费周期开始前即进行扣费。

- 按时计费：一小时为一个计费周期，资源按照每小时的单价进行预扣费；
- 按月计费：一个月（非自然月）为一个计费周期，资源按照每个月的单价进行预扣费；
- 按年计费：一年（顺延年）为一个计费周期，资源按照每年的单进行预扣费；

> 按年按月购买的资源支持随时升降级配置并在升级配置后自动补齐差价。

账户余额不足下一个计费周期时，资源即会自动进入回收站，需要对资源账号及资源进行续费操作后，才可恢复使用；对于删除不进入回收站的资源，账户余额不足下一个计费周期时，资源会自动进入已过期状态，并在 7 天后自行进行删除。

云平台管理员在全局开启"**资源自动续费**"且**账户余额充足时**，则资源在下一个计费周期会进行自动续费操作；若云平台管理员在全局关闭"**资源自动续费**"且**账户余额充足时**，则资源在下一个计费周期会自动进入回收站，需在回收站对资源进行续费操作，并恢复资源。

资源在创建时，所有计费资源的计费计价均会通过资源计价器按照计费方式进行展示，用于确认订单的费用。每个计费周期内的资源均支持释放和删除，当资源在回收站被成功销毁时，将按照计费周期所剩余额进行退费。当账户余额不足时，可通过云平台管理员进行充值。

平台为管理员提供完整的财务管理能力，包括订单管理、交易管理、充值管理、价格配置四大模块。

- 订单管理：查看平台发生的所有订单记录，或者或者自定义查询时间段对订单记录进行查询。

- 交易管理：查看平台所有交易的扣费记录，或者自定义查询时间段对交易的扣费记录进行查询。

- 充值管理：查看平台所有的充值记录，或者自定义查询时间段对充值记录进行搜索。

- 价格配置：对平台售卖的云服务按照预定义的维度进行定价和定价修改。

## 9.2 订单管理

平台管理员可在订单管理页面，通过自定义查询时间查看云平台在一定时间周期内产生的订单，如下图所示：

![order](../images/adminguide/order.png)

- 订单号：订单在云平台的唯一标识符。
- 资源 ID：订单关联资源的资源 ID。
- 订单类型：包括续费和新购两种。
- 订单金额：订单产生的金额。
- 创建时间：订单的发生时间。

支持管理员下载平台所有订单管理记录信息为本地 Excel 文件，为便平台运营管理和报表统计。

## 9.3 交易管理

平台管理员可在交易管理页面，通过自定义查询时间查看云平台在一定时间周期内产生的交易信息，如下图所示：

![tran](../images/adminguide/tran.png)

- 交易单号：交易记录在云平台的唯一标识。
- 交易类型：账户充值和扣费均会生成一次交易记录，因此交易类型包括账户余额充值、免费账户充值及扣费。
- 账户ID：充值的账户 ID。
- 账户名称：充值的账户名称。
- 支出：本次交易支出的费用。
- 收入：本次交易收入的费用。
- 账户余额：本次交易后账户余额。
- 免费余额：本次交易后账户的免费余额。
- 交易时间：本次交易产生的时间。

支持管理员下载平台所有交易记录信息为本地 Excel 文件，为便平台运营管理和报表统计。

## 9.4 充值管理

平台管理员可在充值管理页面，通过自定义查询时间查看云平台在一定时间周期内产生的充值记录信息，如下图所示：

![recharge1](../images/adminguide/recharge1.png)

- 充值单号：充值记录在云平台的唯一标识。
- 充值帐户 ID：充值的账号 ID。
- 充值帐户名称：充值帐户名称。
- 充值邮箱：充值的账户邮箱。
- 充值渠道：充值的渠道。
- 充值方式：充值的金额类型，分为账户余额和免费账户余额。
- 充值金额：充值的金额数。
- 创建时间：充值产生的时间。

支持管理员下载平台所有充值记录信息为本地 Excel 文件，为便平台运营管理和报表统计。

## 9.5 价格配置

### 9.5.1 概述

价格配置即平台全局的产品定价，平台支持对 6 个维度的资源项进行定价，包括 CPU、内存、硬盘、外网、GPU。单个云服务的实际出售价格，根据云服务所涉及到的计费资源项进行累加。租户的价格默认继承全全局配置中的价格，可由管理员自定义租户价格的折扣，以适应平台运营的需求。

| 资源项 | 计费类型     | 计费规则                                       |
| ------ | ------------ | ---------------------------------------------- |
| CPU    | 小时、月、年 | 每个集群每 vCPU 价格                           |
| 内存   | 小时、月、年 | 每个集群每 GB 价格                             |
| 硬盘   | 小时、月、年 | 每个集群每 GB 价格                             |
| 外网IP | 小时、月、年 | 每个网段每 Mb 价格，可以定义带宽不同梯度的价格 |
| GPU    | 小时、月     | 每个集群每颗 GPU 价格                          |

平台在初始化时，会对所有计费项进行初始定价，如果需要修改可在管理平台/账务/价格配置中进行调整。如果平台不需要计费，可以将所有计费项的价格设置为 0 。

### 9.5.2 查看全局价格

支持管理员通过价格配置控制台查看当前平台上所有产品（计费资源）的价格信息，包括产品、地域、集群、计费类型、计费规则、价格、更新时间及操作项。

![price](../images/adminguide/price.png)

通过操作项，管理员可针对每个产品修改在不同集群的价格，计费资源包括 CPU、内存、硬盘、内网带宽、外网IP 及 GPU，租户创建虚拟资源时，通过计费资源的费用合计按照付费方式进行扣费。

* 针对 CPU、内存、GPU 等计算计费资源在不同的计算集群可定义并展示不同的价格。
* 针对硬盘在不同的存储集群可定义并展示不同的价格和折扣。
* 针对内网带宽可展示并定义全局的价格和折扣。
* 针对不同的外网网段可展示并定义不同的价格和折扣。

管理员可通过租户价格列表查看每种资源在不同集群的基准价格，并支持管理员修改每个计费资源的基准价格。

### 9.5.3 修改全局基准价

管理员可在全局价格配置处对每一个计费资源项的全局基准价格进行配置，价格修改后资源项的价格在全局进行变更；管理员对租户自定义的折扣不变，但最终折扣价会随着租户的折扣率进行变更。

* 全局资源项的小时基准定价被更新后，按小时付费的服务将在下一个计费周期按照新的基准价进行扣费。
* 全局资源项的月、年基准定价被更新后，对于已支付的按月和按年服务无影响，在下一个计费周期将按照新的基准价进行扣费。

管理员可在全局价格配置列表上对计费资源项进行价格更新，支持设置单个资源项针对不同集群的基准价，如下图以修改 CPU 在集群 `ComputeSetAAAA` 的按月付费基准价为例：

![upcpuprice](../images/adminguide/upcpuprice.png)

管理员可为每个计费资源项修改基准价格，上图以虚拟机 CPU 为例，可设置单核 vCPU 的每小时价格为 0.2431 元，表示单核 vCPU 的小时单价为 0.2431元。同时平台针对外网 IP 的网段，支持按梯度区间定价，如下图所示：

![bgpprice](../images/adminguide/bgpprice.png)

管理员可针对外网网段（如图上 Bgp 网段） IP 带宽进行梯度区间定价，如 `0M~5M` 的全局基准价格为 1 元，5M~99999999M 的全局基准价格为 10 元，提升平台计费的可维护性。

# 10 平台管理

平台管理为管理员提供平台全局配置、配额配置及自定义规格配置等能力，支持企业和管理员对平台提供服务的进行定制化配置，提升平台的客制化能力。

## 10.1 全局配置

全局配置为管理员提供整个云平台的全局配置信息，包括平台设置、计费设置、控制台安全、硬盘管理、网络设置、邮箱设置、网站设置（企业定制）、登录页设置（企业定制）、回收策略、资源管理及配额设置等。

### 10.1.1 平台设置

平台设置是指对平台本身的设置，包括 NTP 服务器地址及系统版本。

#### 10.1.1.1 NTP 服务器地址

平台支持管理员修改平台的 NTP 服务器地址，使平台可通过新修订的 NTP 服务器同步时间，让平台管理服务可通过准确的时间机制提供服务，如双因子验证、数据库同步、存储同步、操作日志时间及平台上面和时间相关服务。

管理员可通过全局配置中的 NTP 服务器地址查看并修改 NTP 服务器地址，默认为空，如下图所示：

![upntpserver](../images/adminguide/upntpserver.png)

NTP 服务器地址仅支持 IPv4 地址，且 IP 地址必须从平台网络可达，以保证可以和 NTP Server 端进行通信；平台会检测 NTP Server 是否可用。修改 NTP 服务器地址可能会影响平台的服务使用，配置时需要谨慎操作。

#### 10.1.1.2 系统版本

UCloudStack 云平台提供标准版、信创版及快杰版三个发行版本，管理员可通过系统版本参数查看当前系统的版本。仅支持查看不支持修改。

### 10.1.2 计费设置

计费设置是指管理员为平台设置【资源是否自动续费】，默认值为是，即租户悼账户余额充足时，将自动对租户下已有的计费资源进行续费；若管理员将资源是否自动续费关闭时，将不再对租户下资源进行自动续费，资源到期后会即变更为已过期状态，7 天内不进行续费将会自动进行删除或进入回收站。

### 10.1.3 控制台安全

控制台安全配置项是平台为保证控制台及账号安全进行的全局配置，包括是否开启多次登录失败冻结账号、是否开启 90 天强制修改密码、是否禁止多点同时登录及控制台无操作自动退出时长。

1. **是否开启多次登录失败冻结账号**

   平台支持管理员为平台开启或关闭全局账号登录多次失败冻结账号的功能。

   默认值为否，若开启后，输入密码错误 5 次并登陆失败，账号将被冻结，需要联系平台管理员到租户管理的账号列表处对账号进行解冻操作。

2. **是否开启 90 天强制修改密码**

   支持管理员为平台全局账号开启 90 天强制修改密码策略，保证账号安全。

   默认设置为否，若开启后，每 90 天需要账号登录控制台时会要求强制修改账户密码。

3. **是否禁止多点同时登录**

   支持管理员为平台全局账号开启多点登录，以适应对平台账号不同的登录需求。

   默认设置为否，代表平台账号仅支持单点登录，即一个账号同一时间仅支持在一个客户端进行登录，在其它客户端进行登录时将会自动退出已登录的客户端连接。

   若开启多点同时登录，代表平台账号支持多个客户端同时登录，即一个账号在不同的客户端均可同时登录并管理平台资源。

4. **控制台无操作自动退出时长**

   支持管理员为平台全局设置空闲时长，保证控制台资源和数据的安全。

   默认值为 15 分钟，即代表控制台在 15 分钟内无任何操作即会自动退出，支持设置 `1~1440` 分钟。

### 10.1.4 硬盘管理（全局磁盘QoS）

硬盘管理支持管理员对平台全局云硬盘开启或关闭 QoS 控制，以保证平台所有租户云盘资源的性能可靠性。

1. 平台默认全局开启磁盘 QoS ，即代表平台全局硬盘 QoS 生效，包括新建硬盘和已有硬盘的 QoS 。
   * 硬盘默认创建出来会根据平台计算公式赋予 QoS 值。
   * 已有硬盘的 QoS 根据已赋予的默认值或管理员修改的值生效。
   * 配置为开启时，管理员为每个硬盘自定义的 QoS 才可生效。

2. 配置为关闭时，平台全局硬盘 QoS 失效，包括新建硬盘和已有硬盘的QoS。
   * 新创建的硬盘 QoS 不受限制。
   * 已有硬盘的 QoS 不受限制。
   * 配置为关闭时，管理员为每个硬盘自定义的 QoS 不会生效。

3. 硬盘扩容容量后，会根据计算公式重新计算新容量的 QoS 值，根据计算的QoS值重新设置硬盘的 QoS。
   - 若硬盘扩容前设置的 QoS 值  < 新容量 QoS 值，则以新容量 QoS 值为准。
   - 若硬盘扩容前设置的 QoS 值 > 新容量 QoS 值，则以扩容前设置的值为准。

### 10.1.5 网络设置

网络设置支持管理员对平台的 VPC 网段和内网带宽进行配置，其中 VPC 网段是指管理员为平台租户设置 VPC 可使用的 CIDR 网络；内网带宽是指平台 VPC 网络内网带宽的 QoS 。

#### 10.1.5.1 VPC 网段

管理员为平台设置租户可使用 VPC CIDR 网段，默认为 `10.0.0.0/16,172.16.0.0/16,192.168.0.0/16` 三段私有网强行地址，管理员可根据平台实际使用情况进行修改。

设置 VPC 网段后，平台租户创建 VPC 网络时，仅可选择 VPC 网段内配置的私有网段，以适应私有云环境下内网网段冲突的场景。平台建议将 VPC 网段、外网网段及物理网络网段配置为三段不同的地址段，如将 VPC 网段配置为 `172.16.0.0/16`，将外网网段配置为 `192.168.0.0/16` ，物理网络环境配置为 `10.0.0.0/16` ，以方面网络配置及路由下发，同时提升运维效率。

管理员可根据实际网络环境配置 VPC 可使用的网段，本文仅作为示例，以实际私有云网络及部署环境为准。

#### 10.1.5.2 内网带宽 QoS

内网带宽 QoS 是指平台管理员为平台全局的 VPC 内网设置带宽上限，即指定虚拟机 VPC 内网网卡(eth0)间的带宽 QoS 限制。默认值为 4096Mbps ，支持的带宽范围为 `0~8192` 。

当内网带宽设置为 0 时，代表平台全局内网不限制 QoS ，平台建议为内网设置 QoS ，以保证平台所有租户资源 VPC 内网间的带宽性能和可靠性。

### 10.1.6 邮箱设置

邮箱设置是指平台邮件服务的配置，主要功能包注册激活、找回密码及监控告警邮件的接收和发送。平台支持管理员定义邮箱的发件人邮箱地址、发件人邮箱密码、邮件服务器地址、邮箱服务器端口及邮件主题前缀，如图所示：

![email](../images/adminguide/email.png)

- 发件人邮箱地址: 配置发件人的邮箱地址。
- 发件人邮箱密码：配置发件人邮箱密码
- 邮箱服务器地址: 设置发件邮箱的 IP 地址
- 邮箱服务器端口：设置发件邮箱的端口，默认值为 994 ，范围支持 0-65535 。
- 邮箱主题前缀：配置平台发送的提醒邮件的主题前缀，如私有云、政务云等。

> 平台部署时默认必须提供邮箱设置，避免无法接收注册激活、找回密码及监控告警邮件。

### 10.1.7 网站设置（客制化）

网站设置是平台为企业和管理员提供的客制化能力，包括网站 Favicon 图片、网站 Title、云平台 Logo 图片，即自定义云平台的 Logo 及浏览器标志。

- 网站 Favicon 图片：浏览器标签页上展示的 Favicon  图片，必须为 ico 格式，最大不超过 100KB 。
- 网站 Title ：浏览器标签页上展示的网站说明，如`UCloud - 中立 安全 可信赖的云计算服务商`，支持中英文及特殊字符。
- 云平台 Logo 图片：租户和管理员控制台导航栏上方的 logo ，允许管理员自定义，图片支持 png、jpeg、jpg格式，最大不超过 200KB，推荐尺寸 24px*24px 。

### 10.1.8 登录页设置（客制化）

登录页设置是平台为企业和管理员提供的登录客制化能力，包括 SSO 背景图、SSO 标题、SSO 标题颜色等，效果如下图所示：

![ssoimage](../images/adminguide/ssoimage.png)

* SSO 背景图：代表登录框后的背景图片，图片支持png、jpeg、jpg格式，最大不超过500KB 。
* SSO 标题：代表登录框上的标题描述，如 UCloudStack 私有云，可支持中英文及特殊字符。
* SSO 标题颜色：代表登录框上标题的颜色，支持白色、黑色、红色、黄色、绿色、青色、蓝色、棕色、紫色、橙色、灰色及金色，以适应不同背景图片上文字的可读性。

### 10.1.9 回收策略

回收策略是平台为管理员提供的回收站策略的自定义配置，包括回收站资源是否自动销毁、回收站资源自动销毁周期及过期资源是否自动删除进入回收站。

- **回收站资源是否自动销毁**

  设置资源进入回收站后，是否在固定周期后销毁，默认为开启状态；如果实际使用中，无需自动销毁进入回收站的资源，可关闭此配置。

- **回收站资源自动销毁周期**

  资源删除进入回收站后自动删除的周期，仅当开启回收站资源自动销毁时有效，默认值为 360000 秒，支持的范围为 `1~360000` 秒。

- **过期资源是否自动删除进回收站**

  开启后，虚拟机、云硬盘、外网 IP 等资源过期 7 天后会自动进入回收站。进入回收站时，虚拟机关联的资源将会被解绑。若平台的过期资源无需删除，则会自动变更为已过期状态，待 7 天后自动进行删除。

### 10.1.10 资源管理配置

资源管理配置允许管理员配置资源是否允许删除及是否开启计算实例状态检查。

* 资源是否允许删除：管理员对平台全局设置资源是否允许删除，默认值为是，代表允许平台所有租户删除资源。若将此项配置变更为否，则代表平台所有租户无法删除资源。
* 是否开启计算实例状态检查：管理员对平台全局设置计算实例是否进行宕机状态检查，默认为否，若开启后，租户的虚拟机状态中可查看虚拟机的宕机迁移及在线迁移状态。

### 10.1.11 配额设置

配额设置是平台为管理员提供的针对全局资源配额的配置，包括是否开启配额管理及单个硬盘创建快照的上限。

- 是否开启配额管理：设置平台是否需要开启配额管理，默认状态为开启。关闭后，租户创建资源时将不再受租户配额的限制，可以创建任意数量的资源。
- 单个硬盘创建快照上限：设置单个硬盘创建快照的数量上限，默认为 10 个，支持的范围为 `0~200` 个，0 代表单个硬盘创建快照的数量不受限制，管理员可根据平台实际使用情况调整上限数值。

## 10.2 规格配置

规格配置是平台为企业和管理员提供的自定义规格能力，管理人员可通过自定义规格配置调整云平台上架云产品服务的规格类型，包括虚拟机、硬盘、外网 IP 等，其中虚拟机支持定义 CPU  和内存规格；硬盘支持定义租户可创建云盘的容量范围；外网 IP 支持定义租户可申请外网 IP 的带宽范围。

平台针对虚拟机、硬盘、外网 IP 会默认提供建议型的规格，管理员可根据企业需求对规格进行变更，包括创建、查看、删除、修改等。

### 10.2.1 创建规格

创建规格仅支持创建虚拟机 CPU/内存的规格，云硬盘和外网 IP 的规格由平台默认生成，仅支持修改。管理员可通过全局配置——规格配置中的创建规格进行创建操作，如下图所示：

![createspec](../images/adminguide/createspec_1.png)

创建虚拟机规格支持根据不同的集群创建不同的规格，即可为不同的机型创建不同的规格，租户创建虚拟机选择不同机型时，即可创建不同规格的虚拟机，适应不同集群硬件配置不一致的应用场景。可分别定义 CPU 和内存：

* CPU 规格支持（C）：除 1 以外，以2的倍数进行增加，如 1C、2C、4C、6C ，最大值为240C。
* 内存规格支持（G）：除 1 以外，以2的倍数进行增加，如 1G、2G、4G、6G ，最大值为 1024G。

创建出的规格即可被所有租户看到并使用，可根据业务需求在不同的集群中创建不同的规格。

### 10.2.2 查看规格

支持管理员查看平台已定义的所有规格配置，包括虚拟机、硬盘、外网 IP 等产品的规格配置。平台默认会为每个产品针对集群类型生成默认规格，即每个产品会根据集群类型分别生成默认规格，如在计算集群 A 中默认虚拟机规格及存储集群中默认硬盘规格；其中硬盘和外网 IP 规格仅支持查看和修改，不可进行创建和删除。

* 虚拟机规格定义租户创建虚拟机时可选择的 CPU/内存组合，如 1U2G 、2U4G 等。
* 硬盘规格定义租户在创建硬盘时可设置的容量范围（最小容量和最大容量），每个存储集群类型对应一个默认的硬盘容量范围规格。
* 外网 IP 规格定义租户在申请外网 IP 时的带宽范围（最小带宽和最大带宽），每个外网网段对应一个默认的带宽范围规格。

管理员可通过规格配置列表查看当前已有规格的列表信息，包括产品、集群类型、规格类型、规格值、状态、更新时间及操作项，如下图所示：

![speclist](../images/adminguide/speclist.png)

- 产品：代表规格对应的产品，包括虚拟机、硬盘及外网 IP。
- 集群类型：代表规格对应的集群类型或外网网段，指当前规格生效的纬度，如虚拟机在计算集群 A 的 CPU/内存规格；硬盘在存储集群 A 的容量范围规格；外网 IP 在 BGP 网段的带宽范围规格。
- 规格类型：自定义规格对应的规格类型，不同产品的规格类型不同。虚拟机规格类型为 CPU 内存，硬盘的规格类型为容量范围，外网 IP 的规格类型为带宽范围。
- 规格值：代表自定义规格的规格，如 CPU 规格为 1U2G；硬盘容量范围规格为 `10GB~8000GB` ；外网 IP 带宽规格为 `1Mb~10000Mb` 。
- 状态：指自定义规格的状态。
- 更新时间：指自定义规格的更新时间。

管理员可通过自定义规格的列表操作项，对每条规格进行修改和删除操作；同时列表上支持规格配置的搜索。

### 10.2.3 修改规格

支持管理员对已创建和默认生成的规格值进行修改。

（1）虚拟机产品规格支持修改 CPU 和内存值，其中 CPU 可指定 1、2、4、8、16、24、32、64；内存可过年费 定 1、2、4、8、16、24、32、64 、128 ，可根据业务需要自定义组合 CPU 和内存规格。

![upvmspec](../images/adminguide/upvmspec.png)

（2）硬盘产品规格支持修改容量范围的最小容量和最大容量，其中最小容量和最大容量可设置的范围为 10GB 到 8000G ，即平台允许租户创建的云硬盘最小为 10GB ，最大支持到 8000GB ，可根据业务需要调整最小值和最大值。

![updiskspec](../images/adminguide/updiskspec.png)

（3）外网 IP 规格支持修改带宽范围的最小带宽和最大带宽，其中最小带宽和最大带宽可设置的范围为 1Mb 到 10000Mb ，即平台允许租户申请的外网 IP 最小为 1Mb 最到为 10000Mb ，可根据业务需要调整最小值和最大值。

![upnetspec](../images/adminguide/upnetspec.png)

### 10.2.4 删除规格

支持管理员删除指定自定义虚拟机规格，不支持删除硬盘和外网 IP 的规格。如下图所示：

![rmspec](../images/adminguide/rmspec.png)

规格删除后平台租户即不可在所属机型中创建当前规格的虚拟机，但不影响通过该规格创建资源的正常运行。

> 虚拟机规格在每个集群内会生成一条无法删除的默认规格，以避免平台上所有规格均被删除，导致无法创建虚拟机。

## 10.3 配额管理

### 10.3.1 概述

配额（quota）是一个租户（包含子账号）针对每种虚拟资源在一个地域下可创建的数量限制。通过限制每个租户拥有的资源配额，可有效共享并合理分配云平台物理资源，提升资源利用率的同时，满足云平台上每一个账户的资源需求。

**配额管理生效的前提是全局配置中【是否开启配额管理】为的配置项为是，否则配额管理的配置值则不生效。**云平台全局提供每种资源在每个数据中心的默认配额，即每个租户创建时默认提供的资源配额模板。平台管理员可通过租户管理中的配额管理自定义每个租户的资源配额。租户主账号及所拥有的子账号不可自定义修改资源配额数量，仅提供查看配额。

子账号和主账号共享租户的资源配额，即每种资源配额为主账号和所包含的所有子账号可创建的资源数量之和。如租户对于云硬盘的配额为 10 ，则租户的主账号及所有子账号可创建的云硬盘数量上限不可超过 10 个。

管理员可根据平台实际使用情况调整默认配额，调整后及时生效，平台所有已有租户的配额将按照新的配额标准执行，新创建的租户也会按照新的配额标准设置配额限制。

目前配额限制主要包括虚拟机数量、自制镜像数量、VPC 数量、硬盘数量、网卡数量、外网 IP 数量、安全组数量、负载均衡数量、VPN 网关数量、NAT 网关数量、MySQL 数量及 Redis 数量 。支持管理员查看平台全局配额配置，同时支持管理员对配额项进行修改操作。

> 平台支持为单个租户调整配额，可参考租户管理中关于调整租户配额部分的描述。

### 10.3.2 查看配额

管理员可通过全局配置——配额管理查看当前平台全局配额管理中已有的配额配置信息，包括产品类型、地域、配额、更新时间及操作项，如下图所示：

![quatolist](../images/adminguide/quatolist.png)

其中地域代表产品在当前地域中的配额设置，配额值代表在产品在当前地域中的配额值。管理员可通过修改按钮对配额进行修改。

### 10.3.3 修改配额

支持管理员修改平台上地域及全部地域级别的配额值，其中每个产品单个地域配额之和不能超过【全部】地域配额限制，如下图所示：

![upquato](../images/adminguide/upquato.png)

修改全局配额设置不影响为租户自定义的配额设置。全局配额后修改后，若租户已有的产品数量超过设置值，不影响租户已有的资源运行；若租户将资源删除后，则无法再创建超过配额值的资源。
# 11 操作日志

管理控制台的操作日志是为企业及管理员提供的平台全局操作日志，通过平台全局操作日志，可查询当前平台上自身及所有租户对资源的操作和审计信息；默认支持查看 1 天内平台的所有操作审计日志，可选择查看 3 天、7 天及自定义时间长操作日志，最长支持查询 6 个月的操作日志；同时支持管理员通过操作名称、关联资源 ID 及操作者邮件对对操作日志进行搜索。

目前平台全局操作日显示屏 支持查看日志的产品包括虚拟机、自制镜像、弹性网卡、云硬盘、VPC/子网、外网 IP、NAT 网关、VPN网关、弹性伸缩、负载均衡、安全组、帐户、告警模板及定时器等，如下图所示：

![plog.png](../images/adminguide/plog.png)

* 操作（API）名称：指操作日志的操作名称，包括调用 API 的接口名称及操作的界面展示名称，如调整带宽。
* 所属模块：指操作日志操作的资源类型，包括裸金属、虚拟机、虚拟机模板、镜像、VPC、云硬盘、弹性网卡、外网 IP、安全组、负载均衡、NAT 网关、VPN 网关、自动伸缩、监控告警模板、定时器、账户等。
* 关联资源：操作日志对应的资源标识符，并可查看一个操作中所有关联的资源标识，如绑定弹性 IP 对应的虚拟机 ID 和外网 IP 的 ID 。
* 操作者：操作日志对应的操作者，可追溯到具体的平台管理员、主账号及子账号。
* 操作结果：操作日志的结果，如操作成功、操作失败、参数异常、存储集群物理资源不足等。
* 备注：操作日志的备注信息。
* 操作时间：操作日志的操作时间。

为方便管理员便捷的查看操作审计日志，控制台支持日志的筛选和搜索检索，同时支持对导出用户的操作审计日志为 本地 Excel 表格，方便账户管理和运营。

操作日志查询筛选功能可支持所属模块、操作状态及查询时间范围等纬度。所属模块支持所有产品模块的筛选，同时支持查看全部资源的日志及审计信息，即不对所属模块进行筛选；操作状态支持状态为成功、失败的日志筛选，同时也支持查看全部状态的日志和审计信息；查询时间范围支持 1 小时及自定义时间的日志筛选，最长可查询半年的操作日志。

> **操作日志不记录用户在虚拟机内部进行的操作和审计**。

# 12 监控大屏

监控大屏是平台为企业提供的云平台资源可视化大屏，主要展示平台宏观维度的监控数据，帮助企业云平台运营者快速了解平台的整体运行情况，支持自定义拖拽模块及全屏展示，方便管理员进行分屏管理。用户可通过管理员头像左侧的按钮进入监控大屏页面，如下图所示：

![moniterscreen](../images/adminguide/moniterscreen.png)

通知和告警：展示最近 5 条平台告警信息

物理机 TOP5：展示CPU使用率、硬盘读吞吐、硬盘写吞吐、内存使用率在前 5 名的物理节点 IP 。

虚拟机 TOP5：展示CPU使用率、硬盘读吞吐、硬盘写吞吐、内存使用率在前5名的虚拟机 ID 。

资源分配：展示云平台 CPU、内存、存储的总容量以及已分配容量的百分比。

资源概览：展示物理机总量以及状态分布（可用、锁定）、计算集群和存储集群的数量分布、虚拟机总量以及状态分布（运营、关机、其他）。

